<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Pushkar G. Ghanekar">
<meta name="dcterms.date" content="2019-08-02">
<meta name="description" content="Exploratory data analysis and machine leanring model development for property price prediction">

<title>End-to-end Machine Learning Project – Omnis tempus datum</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-d166b450ba5a8e9f7a0ab969bf6592c1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-6bd9cfa162949bde0a231f530c97869d.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-638ce43a2b8cb8132871590242e342ae.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Omnis tempus datum</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About me</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pgg1610"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/mepgg"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">End-to-end Machine Learning Project</h1>
                  <div>
        <div class="description">
          Exploratory data analysis and machine leanring model development for property price prediction
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">python</div>
                <div class="quarto-category">exploratory-data-analysis</div>
                <div class="quarto-category">machine-learning</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Pushkar G. Ghanekar </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 2, 2019</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#step-1-formulate-the-problem" id="toc-step-1-formulate-the-problem" class="nav-link active" data-scroll-target="#step-1-formulate-the-problem">Step 1: Formulate the problem</a></li>
  <li><a href="#step-2-get-the-data" id="toc-step-2-get-the-data" class="nav-link" data-scroll-target="#step-2-get-the-data">Step 2: Get the data</a></li>
  <li><a href="#create-a-test-set" id="toc-create-a-test-set" class="nav-link" data-scroll-target="#create-a-test-set">Create a test-set</a></li>
  <li><a href="#preliminary-visualization-of-the-data" id="toc-preliminary-visualization-of-the-data" class="nav-link" data-scroll-target="#preliminary-visualization-of-the-data">Preliminary visualization of the data</a></li>
  <li><a href="#experimenting-with-attributes" id="toc-experimenting-with-attributes" class="nav-link" data-scroll-target="#experimenting-with-attributes">Experimenting with attributes</a></li>
  <li><a href="#data-cleaning-and-prepping" id="toc-data-cleaning-and-prepping" class="nav-link" data-scroll-target="#data-cleaning-and-prepping">Data cleaning and prepping</a></li>
  <li><a href="#handling-text-and-categorical-attribute" id="toc-handling-text-and-categorical-attribute" class="nav-link" data-scroll-target="#handling-text-and-categorical-attribute">Handling Text and Categorical Attribute</a></li>
  <li><a href="#feature-scaling" id="toc-feature-scaling" class="nav-link" data-scroll-target="#feature-scaling">Feature scaling</a></li>
  <li><a href="#transformation-pipelines" id="toc-transformation-pipelines" class="nav-link" data-scroll-target="#transformation-pipelines">Transformation pipelines</a></li>
  <li><a href="#step-3-select-and-train-a-model" id="toc-step-3-select-and-train-a-model" class="nav-link" data-scroll-target="#step-3-select-and-train-a-model">Step 3: Select and train a model</a>
  <ul class="collapse">
  <li><a href="#training-and-evaluation-on-the-training-set" id="toc-training-and-evaluation-on-the-training-set" class="nav-link" data-scroll-target="#training-and-evaluation-on-the-training-set">Training and evaluation on the training set</a></li>
  <li><a href="#decision-tree-regressor" id="toc-decision-tree-regressor" class="nav-link" data-scroll-target="#decision-tree-regressor">Decision Tree Regressor</a></li>
  <li><a href="#fine-tune-the-model" id="toc-fine-tune-the-model" class="nav-link" data-scroll-target="#fine-tune-the-model">Fine-tune the model</a></li>
  <li><a href="#random-forrest-regressor" id="toc-random-forrest-regressor" class="nav-link" data-scroll-target="#random-forrest-regressor">Random Forrest Regressor</a></li>
  </ul></li>
  <li><a href="#step-4-fine-tune-the-model" id="toc-step-4-fine-tune-the-model" class="nav-link" data-scroll-target="#step-4-fine-tune-the-model">Step 4: Fine-tune the model</a>
  <ul class="collapse">
  <li><a href="#grid-search" id="toc-grid-search" class="nav-link" data-scroll-target="#grid-search">Grid Search</a></li>
  <li><a href="#randomised-search" id="toc-randomised-search" class="nav-link" data-scroll-target="#randomised-search">Randomised search</a></li>
  <li><a href="#ensemble-search" id="toc-ensemble-search" class="nav-link" data-scroll-target="#ensemble-search">Ensemble search</a></li>
  </ul></li>
  <li><a href="#step-5-analyze-the-best-models-and-their-errors" id="toc-step-5-analyze-the-best-models-and-their-errors" class="nav-link" data-scroll-target="#step-5-analyze-the-best-models-and-their-errors">Step 5: Analyze the Best Models and their Errors</a></li>
  <li><a href="#step-6-evaluate-the-model-on-the-test-set" id="toc-step-6-evaluate-the-model-on-the-test-set" class="nav-link" data-scroll-target="#step-6-evaluate-the-model-on-the-test-set">Step 6: Evaluate the model on the Test Set</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>This project is adapted from Aurelien Geron’s ML book <a href="https://github.com/ageron/handson-ml">(Github link)</a> . The aim to predict median house values in Californian districts, given a number of features from these districts.</p>
<p>Main steps we will go through: 1. Formulate the problem 2. Get the data 3. Discover and visualize data / Data exploration to gain insight 4. Prep data for ML algorithm testing 5. Select model and train it 6. Fine-tuning the model</p>
<section id="step-1-formulate-the-problem" class="level3">
<h3 class="anchored" data-anchor-id="step-1-formulate-the-problem">Step 1: Formulate the problem</h3>
<p>Prediction of district’s median housing price given all other metrics. A supervised learning task is where we are given ‘labelled’ data for training purpose. Regression model to predict a continuous variable i.e.&nbsp;district median housing price. Given multiple features, this is a multi-class regression type problem. Univariate regression since a single output is estimated.</p>
</section>
<section id="step-2-get-the-data" class="level3">
<h3 class="anchored" data-anchor-id="step-2-get-the-data">Step 2: Get the data</h3>
<div id="cell-2" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-3" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#----- PLOTTING PARAMS ----# </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.pyplot <span class="im">import</span> cm</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"whitegrid"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>sns.color_palette(<span class="st">"husl"</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>config InlineBackend.figure_format <span class="op">=</span> <span class="st">'retina'</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>config InlineBackend.print_figure_kwargs<span class="op">=</span>{<span class="st">'facecolor'</span> : <span class="st">"w"</span>}</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>plot_params <span class="op">=</span> {</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="st">'font.size'</span> : <span class="dv">30</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="st">'axes.titlesize'</span> : <span class="dv">24</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="st">'axes.labelsize'</span> : <span class="dv">20</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="st">'axes.labelweight'</span> : <span class="st">'bold'</span>,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="st">'lines.linewidth'</span> : <span class="dv">3</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="st">'lines.markersize'</span> : <span class="dv">10</span>,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="st">'xtick.labelsize'</span> : <span class="dv">16</span>,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="st">'ytick.labelsize'</span> : <span class="dv">16</span>,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update(plot_params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-4" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Load the dataset </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>housing <span class="op">=</span> pd.read_csv(<span class="st">'./data/housing.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-5" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>housing.sample(<span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">housing_median_age</th>
<th data-quarto-table-cell-role="th">total_rooms</th>
<th data-quarto-table-cell-role="th">total_bedrooms</th>
<th data-quarto-table-cell-role="th">population</th>
<th data-quarto-table-cell-role="th">households</th>
<th data-quarto-table-cell-role="th">median_income</th>
<th data-quarto-table-cell-role="th">median_house_value</th>
<th data-quarto-table-cell-role="th">ocean_proximity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">10769</td>
<td>-117.89</td>
<td>33.66</td>
<td>33.0</td>
<td>3595.0</td>
<td>785.0</td>
<td>1621.0</td>
<td>732.0</td>
<td>4.1372</td>
<td>265200.0</td>
<td>&lt;1H OCEAN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4165</td>
<td>-118.20</td>
<td>34.11</td>
<td>36.0</td>
<td>1441.0</td>
<td>534.0</td>
<td>1809.0</td>
<td>500.0</td>
<td>2.1793</td>
<td>185700.0</td>
<td>&lt;1H OCEAN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3685</td>
<td>-118.37</td>
<td>34.21</td>
<td>36.0</td>
<td>2080.0</td>
<td>455.0</td>
<td>1939.0</td>
<td>484.0</td>
<td>4.2875</td>
<td>176600.0</td>
<td>&lt;1H OCEAN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8040</td>
<td>-118.15</td>
<td>33.84</td>
<td>37.0</td>
<td>1508.0</td>
<td>252.0</td>
<td>635.0</td>
<td>241.0</td>
<td>3.7500</td>
<td>221300.0</td>
<td>&lt;1H OCEAN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11836</td>
<td>-120.98</td>
<td>39.08</td>
<td>20.0</td>
<td>4570.0</td>
<td>906.0</td>
<td>2125.0</td>
<td>815.0</td>
<td>3.0403</td>
<td>148000.0</td>
<td>INLAND</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1525</td>
<td>-122.07</td>
<td>37.89</td>
<td>28.0</td>
<td>3410.0</td>
<td>746.0</td>
<td>1428.0</td>
<td>670.0</td>
<td>4.3864</td>
<td>266800.0</td>
<td>NEAR BAY</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18180</td>
<td>-122.03</td>
<td>37.37</td>
<td>9.0</td>
<td>2966.0</td>
<td>770.0</td>
<td>1430.0</td>
<td>740.0</td>
<td>3.0047</td>
<td>256000.0</td>
<td>&lt;1H OCEAN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Each row presents one district. Each of these districts has 10 attributes (features).</p>
<div id="cell-7" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>housing.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 20640 entries, 0 to 20639
Data columns (total 10 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   longitude           20640 non-null  float64
 1   latitude            20640 non-null  float64
 2   housing_median_age  20640 non-null  float64
 3   total_rooms         20640 non-null  float64
 4   total_bedrooms      20433 non-null  float64
 5   population          20640 non-null  float64
 6   households          20640 non-null  float64
 7   median_income       20640 non-null  float64
 8   median_house_value  20640 non-null  float64
 9   ocean_proximity     20640 non-null  object 
dtypes: float64(9), object(1)
memory usage: 1.6+ MB</code></pre>
</div>
</div>
<p>One thing to notice in this dataset is the number of total_bedroom entries is different from other entries. This suggests there are some missing entries or null in the dataset.</p>
<div id="cell-9" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#To show the null elements (if any in the total_bedroom entries)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>housing[housing.total_bedrooms.isnull()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">housing_median_age</th>
<th data-quarto-table-cell-role="th">total_rooms</th>
<th data-quarto-table-cell-role="th">total_bedrooms</th>
<th data-quarto-table-cell-role="th">population</th>
<th data-quarto-table-cell-role="th">households</th>
<th data-quarto-table-cell-role="th">median_income</th>
<th data-quarto-table-cell-role="th">median_house_value</th>
<th data-quarto-table-cell-role="th">ocean_proximity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">290</td>
<td>-122.16</td>
<td>37.77</td>
<td>47.0</td>
<td>1256.0</td>
<td>NaN</td>
<td>570.0</td>
<td>218.0</td>
<td>4.3750</td>
<td>161900.0</td>
<td>NEAR BAY</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">341</td>
<td>-122.17</td>
<td>37.75</td>
<td>38.0</td>
<td>992.0</td>
<td>NaN</td>
<td>732.0</td>
<td>259.0</td>
<td>1.6196</td>
<td>85100.0</td>
<td>NEAR BAY</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">538</td>
<td>-122.28</td>
<td>37.78</td>
<td>29.0</td>
<td>5154.0</td>
<td>NaN</td>
<td>3741.0</td>
<td>1273.0</td>
<td>2.5762</td>
<td>173400.0</td>
<td>NEAR BAY</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">563</td>
<td>-122.24</td>
<td>37.75</td>
<td>45.0</td>
<td>891.0</td>
<td>NaN</td>
<td>384.0</td>
<td>146.0</td>
<td>4.9489</td>
<td>247100.0</td>
<td>NEAR BAY</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">696</td>
<td>-122.10</td>
<td>37.69</td>
<td>41.0</td>
<td>746.0</td>
<td>NaN</td>
<td>387.0</td>
<td>161.0</td>
<td>3.9063</td>
<td>178400.0</td>
<td>NEAR BAY</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20267</td>
<td>-119.19</td>
<td>34.20</td>
<td>18.0</td>
<td>3620.0</td>
<td>NaN</td>
<td>3171.0</td>
<td>779.0</td>
<td>3.3409</td>
<td>220500.0</td>
<td>NEAR OCEAN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20268</td>
<td>-119.18</td>
<td>34.19</td>
<td>19.0</td>
<td>2393.0</td>
<td>NaN</td>
<td>1938.0</td>
<td>762.0</td>
<td>1.6953</td>
<td>167400.0</td>
<td>NEAR OCEAN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20372</td>
<td>-118.88</td>
<td>34.17</td>
<td>15.0</td>
<td>4260.0</td>
<td>NaN</td>
<td>1701.0</td>
<td>669.0</td>
<td>5.1033</td>
<td>410700.0</td>
<td>&lt;1H OCEAN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20460</td>
<td>-118.75</td>
<td>34.29</td>
<td>17.0</td>
<td>5512.0</td>
<td>NaN</td>
<td>2734.0</td>
<td>814.0</td>
<td>6.6073</td>
<td>258100.0</td>
<td>&lt;1H OCEAN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20484</td>
<td>-118.72</td>
<td>34.28</td>
<td>17.0</td>
<td>3051.0</td>
<td>NaN</td>
<td>1705.0</td>
<td>495.0</td>
<td>5.7376</td>
<td>218600.0</td>
<td>&lt;1H OCEAN</td>
</tr>
</tbody>
</table>

<p>207 rows × 10 columns</p>
</div>
</div>
</div>
<p>For categorical entries (here, ocean_proximity entries) we can find out the entries and their number using the value_counts(). We can do this for any entry we wish but makes more sense for categorical entries.</p>
<div id="cell-11" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>housing[<span class="st">"ocean_proximity"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>&lt;1H OCEAN     9136
INLAND        6551
NEAR OCEAN    2658
NEAR BAY      2290
ISLAND           5
Name: ocean_proximity, dtype: int64</code></pre>
</div>
</div>
<div id="cell-12" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>housing.describe().<span class="bu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">housing_median_age</th>
<th data-quarto-table-cell-role="th">total_rooms</th>
<th data-quarto-table-cell-role="th">total_bedrooms</th>
<th data-quarto-table-cell-role="th">population</th>
<th data-quarto-table-cell-role="th">households</th>
<th data-quarto-table-cell-role="th">median_income</th>
<th data-quarto-table-cell-role="th">median_house_value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>20640.00</td>
<td>20640.00</td>
<td>20640.00</td>
<td>20640.00</td>
<td>20433.00</td>
<td>20640.00</td>
<td>20640.00</td>
<td>20640.00</td>
<td>20640.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>-119.57</td>
<td>35.63</td>
<td>28.64</td>
<td>2635.76</td>
<td>537.87</td>
<td>1425.48</td>
<td>499.54</td>
<td>3.87</td>
<td>206855.82</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>2.00</td>
<td>2.14</td>
<td>12.59</td>
<td>2181.62</td>
<td>421.39</td>
<td>1132.46</td>
<td>382.33</td>
<td>1.90</td>
<td>115395.62</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>-124.35</td>
<td>32.54</td>
<td>1.00</td>
<td>2.00</td>
<td>1.00</td>
<td>3.00</td>
<td>1.00</td>
<td>0.50</td>
<td>14999.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>-121.80</td>
<td>33.93</td>
<td>18.00</td>
<td>1447.75</td>
<td>296.00</td>
<td>787.00</td>
<td>280.00</td>
<td>2.56</td>
<td>119600.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>-118.49</td>
<td>34.26</td>
<td>29.00</td>
<td>2127.00</td>
<td>435.00</td>
<td>1166.00</td>
<td>409.00</td>
<td>3.53</td>
<td>179700.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>-118.01</td>
<td>37.71</td>
<td>37.00</td>
<td>3148.00</td>
<td>647.00</td>
<td>1725.00</td>
<td>605.00</td>
<td>4.74</td>
<td>264725.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>-114.31</td>
<td>41.95</td>
<td>52.00</td>
<td>39320.00</td>
<td>6445.00</td>
<td>35682.00</td>
<td>6082.00</td>
<td>15.00</td>
<td>500001.00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Describe is powerful subroutine since that allows us to check the stat summary of numerical attributes</p>
<p>The 25%-50%-75% entries for each column show corresponding percentiles. It indicates the value below which a given percentage of observations in a group of observations fall. For example, 25% of observation have median income below 2.56, 50% observations have median income below 3.53, and 75% observations have median income below 4.74. 25% –&gt; 1st Quartile, 50% –&gt; Median, 75% –&gt; 3rd Quartile</p>
<div id="cell-15" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>housing.hist(bins<span class="op">=</span><span class="dv">50</span>,figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">20</span>))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2019-08-02-end2endML_housing_files/figure-html/cell-10-output-1.png" width="1187" height="1149" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Few observations from the Histogram plots, again remember each row is an entry for an ENTIRE district:</p>
<blockquote class="blockquote">
<p>NOTICE: From the dataset’s source disclaimer: The housing_median_value, housing_median_age, median_income_value are capped at an arbitrary value.</p>
</blockquote>
<ol type="1">
<li>From latitute and longitude plots there seems to be lots of district in four particular locations (34,37 – latitude) and (-120,-118 – longitude). We cannot comment on the exact location but only one on these pairs giving most data.</li>
<li>We see a tighter distribution for total_rooms, total_bedrooms, and population but spread for house_value and an intresting spike at its end.</li>
<li>Small spike at the end of median_income plot suggests presence of small group of affluent families but interestingly that spike does not correlate with the spike in the house_value (More high-end property entries than more “rich” people in a district)</li>
</ol>
<p>Finally, the dataset is tail-heavy that is they extend further to the right from the median which might make modeling using some ML algorithm a bit chanellenging. Few entries should be scaled such that the distribution is more normal.</p>
</section>
<section id="create-a-test-set" class="level3">
<h3 class="anchored" data-anchor-id="create-a-test-set">Create a test-set</h3>
<p>This ensures that this is the data on which training, testing occurs and we do not try overfitting to account for all the variance in the data. Typical 20% of data-points are randomly chosen.</p>
<div id="cell-17" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> split_train_test(data,test_ratio):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    shuffled_indices<span class="op">=</span>np.random.permutation(<span class="bu">len</span>(data))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    test_set_size<span class="op">=</span><span class="bu">int</span>(<span class="bu">len</span>(data)<span class="op">*</span>test_ratio)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    test_indices<span class="op">=</span>shuffled_indices[:test_set_size]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    train_indices<span class="op">=</span>shuffled_indices[test_set_size:]</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(data.iloc[train_indices],data.iloc[test_indices])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-18" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#To ensure we get similar results at each run -- if not initiated every successive will give more random </span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#shuffled indices risking the possibility of the algo seeing the entire dataset! </span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Random seed set to 42 for no particular reason </span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">#but just cause its the answer to the Ultimate Question of Life, The Universe, and Everything</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>train_set, test_set <span class="op">=</span> split_train_test(housing, <span class="fl">0.2</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(train_set), <span class="st">"train +"</span>, <span class="bu">len</span>(test_set), <span class="st">"test"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>16512 train + 4128 test</code></pre>
</div>
</div>
<p>Better way is to have an instance identifier (like id) for each entry to distingusih each entry and see if its sampled or not.</p>
<div id="cell-20" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> zlib <span class="im">import</span> crc32</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_set_check(identifier, test_ratio):</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> crc32(np.int64(identifier)) <span class="op">&amp;</span> <span class="bn">0xffffffff</span> <span class="op">&lt;</span> test_ratio <span class="op">*</span> <span class="dv">2</span><span class="op">**</span><span class="dv">32</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> split_train_test_by_id(data, test_ratio, id_column):</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    ids <span class="op">=</span> data[id_column]</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    in_test_set <span class="op">=</span> ids.<span class="bu">apply</span>(<span class="kw">lambda</span> id_: test_set_check(id_, test_ratio))</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data.loc[<span class="op">~</span>in_test_set], data.loc[in_test_set]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The dataset currently doesnt have inherent id. We could use the row index as id. Or we could use an ad-hoc unique identifier as an interim id.</p>
<div id="cell-22" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#HOUSING DATA WITH ID as ROW INDEX</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>housing_with_id <span class="op">=</span> housing.reset_index()   <span class="co"># adds an `index` column</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>train_set, test_set <span class="op">=</span> split_train_test_by_id(housing_with_id, <span class="fl">0.2</span>, <span class="st">"index"</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">#HOUSING DATA WITH ID AS COMBO OF LAT AND LONG. </span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>housing_with_id[<span class="st">"id"</span>] <span class="op">=</span> housing[<span class="st">"longitude"</span>] <span class="op">*</span> <span class="dv">1000</span> <span class="op">+</span> housing[<span class="st">"latitude"</span>]</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>train_set, test_set <span class="op">=</span> split_train_test_by_id(housing_with_id, <span class="fl">0.2</span>, <span class="st">"id"</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">#SCIKIT-LEARN IMPLEMENTATION</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co">#from sklearn.model_selection import train_test_split</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">#train_set, test_set = train_test_split(housing, test_size=0.2, random_state=42)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-23" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>test_set.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">housing_median_age</th>
<th data-quarto-table-cell-role="th">total_rooms</th>
<th data-quarto-table-cell-role="th">total_bedrooms</th>
<th data-quarto-table-cell-role="th">population</th>
<th data-quarto-table-cell-role="th">households</th>
<th data-quarto-table-cell-role="th">median_income</th>
<th data-quarto-table-cell-role="th">median_house_value</th>
<th data-quarto-table-cell-role="th">ocean_proximity</th>
<th data-quarto-table-cell-role="th">id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">59</td>
<td>59</td>
<td>-122.29</td>
<td>37.82</td>
<td>2.0</td>
<td>158.0</td>
<td>43.0</td>
<td>94.0</td>
<td>57.0</td>
<td>2.5625</td>
<td>60000.0</td>
<td>NEAR BAY</td>
<td>-122252.18</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">60</td>
<td>60</td>
<td>-122.29</td>
<td>37.83</td>
<td>52.0</td>
<td>1121.0</td>
<td>211.0</td>
<td>554.0</td>
<td>187.0</td>
<td>3.3929</td>
<td>75700.0</td>
<td>NEAR BAY</td>
<td>-122252.17</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">61</td>
<td>61</td>
<td>-122.29</td>
<td>37.82</td>
<td>49.0</td>
<td>135.0</td>
<td>29.0</td>
<td>86.0</td>
<td>23.0</td>
<td>6.1183</td>
<td>75000.0</td>
<td>NEAR BAY</td>
<td>-122252.18</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">62</td>
<td>62</td>
<td>-122.29</td>
<td>37.81</td>
<td>50.0</td>
<td>760.0</td>
<td>190.0</td>
<td>377.0</td>
<td>122.0</td>
<td>0.9011</td>
<td>86100.0</td>
<td>NEAR BAY</td>
<td>-122252.19</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">67</td>
<td>67</td>
<td>-122.29</td>
<td>37.80</td>
<td>52.0</td>
<td>1027.0</td>
<td>244.0</td>
<td>492.0</td>
<td>147.0</td>
<td>2.6094</td>
<td>81300.0</td>
<td>NEAR BAY</td>
<td>-122252.20</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>However the sampling we have considered here or the one used in Scikit-learn is random sampling by default. This is fine for large dataset however for smaller dataset it is utmost important that the sampled data is representative of the main population data or else we will introduce sampling bias.</p>
<p>This is an important bias that could be introduced without prior knowledge and could be overlooked at multiple occassion leading to wrong conclusions. To ensure the sampled dataset is representative of the population set we use stratified sampling (pseudo-random sampling). To make the stratified sampling tractable we first divide the main data into multiple ‘stratas’ based on an variable which we feel is an feature that should be replicated in our test set. The sample is divided into strata and right number of instances are chosen from each strata. We must not have too many stratas and the each strate must have appropriate number of instances.</p>
<p>For the case of property pricing in the district, median_income variable is chosen as the variable whose distribution in the main population and the randomly chosen test sample is same. This attribute is an important attribute to predict the final median housing price. So we can think of converting the continuous variable of median_variable into categorical variable – that is stratas.</p>
<section id="stratified-sampling-using-median-income" class="level4">
<h4 class="anchored" data-anchor-id="stratified-sampling-using-median-income">Stratified sampling using median income</h4>
<div id="cell-25" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>housing[<span class="st">"median_income"</span>].hist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2019-08-02-end2endML_housing_files/figure-html/cell-16-output-1.png" width="394" height="255" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>From the median_income histogram it is seen that most of the entries are clustered in the range of 2-5 (arbitrary units). We can then use this information to make stratas around these instances. Cut routine in the pandas is used for this purpose. This function is also useful for going from a continuous variable to a categorical variable. For example, cut could convert ages to groups of age ranges.</p>
<div id="cell-27" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>housing[<span class="st">"income_cat"</span>] <span class="op">=</span> pd.cut(housing[<span class="st">"median_income"</span>],</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                               bins<span class="op">=</span>[<span class="fl">0.</span>, <span class="fl">1.5</span>, <span class="fl">3.0</span>, <span class="fl">4.5</span>, <span class="fl">6.</span>, np.inf], <span class="co">#bins around 2-5 income bracket</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                               labels<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>housing[<span class="st">"income_cat"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>3    7236
2    6581
4    3639
5    2362
1     822
Name: income_cat, dtype: int64</code></pre>
</div>
</div>
<div id="cell-28" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>housing[<span class="st">"income_cat"</span>].hist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2019-08-02-end2endML_housing_files/figure-html/cell-18-output-1.png" width="394" height="255" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Now with the population categorised into various median income groups we can use stratified sampling routine (as implemented in scikit-learn) to make our test-set. As an additional proof let’s compare this to a randomly sampled test_case. We will redo the random sampling we did prviously but with the new population with categorised median_income.</p>
<div id="cell-30" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Stratified sampling from scikit-learn </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> StratifiedShuffleSplit, train_test_split</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>split <span class="op">=</span> StratifiedShuffleSplit(n_splits<span class="op">=</span><span class="dv">1</span>, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train_index, test_index <span class="kw">in</span> split.split(housing, housing[<span class="st">"income_cat"</span>]):</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    strat_train_set <span class="op">=</span> housing.loc[train_index]</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    strat_test_set <span class="op">=</span> housing.loc[test_index]</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Using random sampling</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>rand_train_set, rand_test_set <span class="op">=</span> train_test_split(housing, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s check the distribution of the income_cat variable in the strat_test, random_test, and the main sample.</p>
<div id="cell-32" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>housing[<span class="st">"income_cat"</span>].value_counts()<span class="op">/</span><span class="bu">len</span>(housing[<span class="st">"income_cat"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>3    0.350581
2    0.318847
4    0.176308
5    0.114438
1    0.039826
Name: income_cat, dtype: float64</code></pre>
</div>
</div>
<div id="cell-33" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>rand_test_set[<span class="st">"income_cat"</span>].value_counts()<span class="op">/</span><span class="bu">len</span>(rand_test_set[<span class="st">"income_cat"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>3    0.358527
2    0.324370
4    0.167393
5    0.109496
1    0.040213
Name: income_cat, dtype: float64</code></pre>
</div>
</div>
<div id="cell-34" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>strat_test_set[<span class="st">"income_cat"</span>].value_counts()<span class="op">/</span><span class="bu">len</span>(strat_test_set[<span class="st">"income_cat"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>3    0.350533
2    0.318798
4    0.176357
5    0.114583
1    0.039729
Name: income_cat, dtype: float64</code></pre>
</div>
</div>
<div id="cell-35" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> income_cat_proportions(data):</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data[<span class="st">"income_cat"</span>].value_counts() <span class="op">/</span> <span class="bu">len</span>(data)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>compare_props <span class="op">=</span> pd.DataFrame({</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Overall"</span>: income_cat_proportions(housing),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Stratified"</span>: income_cat_proportions(strat_test_set),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Random"</span>: income_cat_proportions(rand_test_set),</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>}).sort_index()</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>compare_props[<span class="st">"Rand. </span><span class="sc">%e</span><span class="st">rror"</span>] <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> compare_props[<span class="st">"Random"</span>] <span class="op">/</span> compare_props[<span class="st">"Overall"</span>] <span class="op">-</span> <span class="dv">100</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>compare_props[<span class="st">"Strat. </span><span class="sc">%e</span><span class="st">rror"</span>] <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> compare_props[<span class="st">"Stratified"</span>] <span class="op">/</span> compare_props[<span class="st">"Overall"</span>] <span class="op">-</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-36" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>compare_props</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Overall</th>
<th data-quarto-table-cell-role="th">Stratified</th>
<th data-quarto-table-cell-role="th">Random</th>
<th data-quarto-table-cell-role="th">Rand. %error</th>
<th data-quarto-table-cell-role="th">Strat. %error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>0.039826</td>
<td>0.039729</td>
<td>0.040213</td>
<td>0.973236</td>
<td>-0.243309</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>0.318847</td>
<td>0.318798</td>
<td>0.324370</td>
<td>1.732260</td>
<td>-0.015195</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>0.350581</td>
<td>0.350533</td>
<td>0.358527</td>
<td>2.266446</td>
<td>-0.013820</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>0.176308</td>
<td>0.176357</td>
<td>0.167393</td>
<td>-5.056334</td>
<td>0.027480</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>0.114438</td>
<td>0.114583</td>
<td>0.109496</td>
<td>-4.318374</td>
<td>0.127011</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now, we can remove the income_cat column</p>
<div id="cell-38" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> set_ <span class="kw">in</span> (strat_train_set, strat_test_set):</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    set_.drop(<span class="st">"income_cat"</span>, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="preliminary-visualization-of-the-data" class="level3">
<h3 class="anchored" data-anchor-id="preliminary-visualization-of-the-data">Preliminary visualization of the data</h3>
<p>Let’s now dive a bit deeper into the data visualization and analysis. Before we do so, copy the strat_train_set as that would be the data-set we would be playing around and make sure the main data-set is not touched.</p>
<div id="cell-40" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>housing<span class="op">=</span>strat_train_set.copy()</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>housing.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
Int64Index: 16512 entries, 17606 to 15775
Data columns (total 10 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   longitude           16512 non-null  float64
 1   latitude            16512 non-null  float64
 2   housing_median_age  16512 non-null  float64
 3   total_rooms         16512 non-null  float64
 4   total_bedrooms      16354 non-null  float64
 5   population          16512 non-null  float64
 6   households          16512 non-null  float64
 7   median_income       16512 non-null  float64
 8   median_house_value  16512 non-null  float64
 9   ocean_proximity     16512 non-null  object 
dtypes: float64(9), object(1)
memory usage: 1.4+ MB</code></pre>
</div>
</div>
<section id="geographical-visualization" class="level4">
<h4 class="anchored" data-anchor-id="geographical-visualization">Geographical visualization</h4>
<p>Let’s now plot the data entries in the housing data as per the latitude and longitude.</p>
<div id="cell-42" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>housing.plot(kind<span class="op">=</span><span class="st">'scatter'</span>,x<span class="op">=</span><span class="st">'longitude'</span>,y<span class="op">=</span><span class="st">'latitude'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>*c* argument looks like a single numeric RGB or RGBA sequence, which should be avoided as value-mapping will have precedence in case its length matches with *x* &amp; *y*.  Please use the *color* keyword-argument or provide a 2D array with a single row if you intend to specify the same RGB or RGBA value for all points.</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2019-08-02-end2endML_housing_files/figure-html/cell-27-output-2.png" width="410" height="278" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This look’s like California however, we cannot infer anything more out of this. Let’s play around a little bit more…</p>
<ol type="1">
<li>Playing with the alpha value in the plotting routine allows us to see the frequency of THAT datapoint in the plot</li>
</ol>
<div id="cell-44" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>housing.plot(kind<span class="op">=</span><span class="st">'scatter'</span>,x<span class="op">=</span><span class="st">'longitude'</span>,y<span class="op">=</span><span class="st">'latitude'</span>,alpha<span class="op">=</span><span class="fl">0.1</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>*c* argument looks like a single numeric RGB or RGBA sequence, which should be avoided as value-mapping will have precedence in case its length matches with *x* &amp; *y*.  Please use the *color* keyword-argument or provide a 2D array with a single row if you intend to specify the same RGB or RGBA value for all points.</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2019-08-02-end2endML_housing_files/figure-html/cell-28-output-2.png" width="410" height="278" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>From here, we can see the high density of listings in the Bay area and LA also around Sacramento and Fresco.</p>
<div id="cell-46" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>housing.plot(kind<span class="op">=</span><span class="st">"scatter"</span>, x<span class="op">=</span><span class="st">"longitude"</span>, y<span class="op">=</span><span class="st">"latitude"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    s<span class="op">=</span>housing[<span class="st">"population"</span>]<span class="op">/</span><span class="dv">100</span>, label<span class="op">=</span><span class="st">"population"</span>, figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">5</span>),</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    c<span class="op">=</span><span class="st">"median_house_value"</span>, cmap<span class="op">=</span>plt.get_cmap(<span class="st">"jet"</span>), colorbar<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    sharex<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>plt.legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2019-08-02-end2endML_housing_files/figure-html/cell-29-output-1.png" width="541" height="338" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This is more interesting! We have now plotted the data with more information. Each data-point has two additional set of info apart of frequency of occurence. First being the color of the point is the median_house_value entry (option c). The radius of the data-point is the population of that district (option s). It can be seen that the housing prices are very much related to the location. The ones closer to the bay area are more expensive but need not be densely populated.</p>
</section>
<section id="looking-for-simple-correlations" class="level4">
<h4 class="anchored" data-anchor-id="looking-for-simple-correlations">Looking for simple correlations</h4>
<p>In addition to looking at the plot of housing price, we can check for simpler correaltions. Pearson’s correlation matrix is something which is in-built in pandas and can be directly used. It checks for correlation between every pair of feature provided in the data-set. It estimates the covariance of the two features and estimates whether the correlation is inverse, direct, or none.</p>
<div id="cell-48" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>corr_matrix<span class="op">=</span>housing.corr()</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>corr_matrix.style.background_gradient(cmap<span class="op">=</span><span class="st">'coolwarm'</span>).set_precision(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<style type="text/css">
#T_dfdc4_row0_col0,#T_dfdc4_row1_col1,#T_dfdc4_row2_col2,#T_dfdc4_row3_col3,#T_dfdc4_row4_col4,#T_dfdc4_row5_col5,#T_dfdc4_row6_col6,#T_dfdc4_row7_col7,#T_dfdc4_row8_col8{
            background-color:  #b40426;
            color:  #f1f1f1;
        }#T_dfdc4_row0_col1,#T_dfdc4_row1_col0,#T_dfdc4_row1_col8,#T_dfdc4_row2_col3,#T_dfdc4_row2_col4,#T_dfdc4_row2_col5,#T_dfdc4_row2_col6,#T_dfdc4_row2_col7,#T_dfdc4_row3_col2{
            background-color:  #3b4cc0;
            color:  #f1f1f1;
        }#T_dfdc4_row0_col2,#T_dfdc4_row1_col4{
            background-color:  #779af7;
            color:  #000000;
        }#T_dfdc4_row0_col3,#T_dfdc4_row0_col4{
            background-color:  #9fbfff;
            color:  #000000;
        }#T_dfdc4_row0_col5{
            background-color:  #a3c2fe;
            color:  #000000;
        }#T_dfdc4_row0_col6,#T_dfdc4_row8_col4,#T_dfdc4_row8_col6{
            background-color:  #98b9ff;
            color:  #000000;
        }#T_dfdc4_row0_col7,#T_dfdc4_row0_col8{
            background-color:  #5470de;
            color:  #000000;
        }#T_dfdc4_row1_col2{
            background-color:  #94b6ff;
            color:  #000000;
        }#T_dfdc4_row1_col3{
            background-color:  #89acfd;
            color:  #000000;
        }#T_dfdc4_row1_col5{
            background-color:  #6788ee;
            color:  #000000;
        }#T_dfdc4_row1_col6{
            background-color:  #7295f4;
            color:  #000000;
        }#T_dfdc4_row1_col7{
            background-color:  #445acc;
            color:  #f1f1f1;
        }#T_dfdc4_row2_col0{
            background-color:  #c7d7f0;
            color:  #000000;
        }#T_dfdc4_row2_col1{
            background-color:  #d8dce2;
            color:  #000000;
        }#T_dfdc4_row2_col8{
            background-color:  #84a7fc;
            color:  #000000;
        }#T_dfdc4_row3_col0{
            background-color:  #dedcdb;
            color:  #000000;
        }#T_dfdc4_row3_col1{
            background-color:  #d2dbe8;
            color:  #000000;
        }#T_dfdc4_row3_col4,#T_dfdc4_row4_col3{
            background-color:  #c73635;
            color:  #f1f1f1;
        }#T_dfdc4_row3_col5{
            background-color:  #d95847;
            color:  #000000;
        }#T_dfdc4_row3_col6,#T_dfdc4_row6_col3{
            background-color:  #ca3b37;
            color:  #f1f1f1;
        }#T_dfdc4_row3_col7{
            background-color:  #97b8ff;
            color:  #000000;
        }#T_dfdc4_row3_col8,#T_dfdc4_row7_col6{
            background-color:  #8badfd;
            color:  #000000;
        }#T_dfdc4_row4_col0{
            background-color:  #e2dad5;
            color:  #000000;
        }#T_dfdc4_row4_col1{
            background-color:  #cdd9ec;
            color:  #000000;
        }#T_dfdc4_row4_col2{
            background-color:  #4358cb;
            color:  #f1f1f1;
        }#T_dfdc4_row4_col5{
            background-color:  #d55042;
            color:  #000000;
        }#T_dfdc4_row4_col6,#T_dfdc4_row6_col4{
            background-color:  #b8122a;
            color:  #f1f1f1;
        }#T_dfdc4_row4_col7{
            background-color:  #5673e0;
            color:  #000000;
        }#T_dfdc4_row4_col8{
            background-color:  #6f92f3;
            color:  #000000;
        }#T_dfdc4_row5_col0{
            background-color:  #e6d7cf;
            color:  #000000;
        }#T_dfdc4_row5_col1{
            background-color:  #c6d6f1;
            color:  #000000;
        }#T_dfdc4_row5_col2{
            background-color:  #4961d2;
            color:  #f1f1f1;
        }#T_dfdc4_row5_col3{
            background-color:  #d85646;
            color:  #000000;
        }#T_dfdc4_row5_col4{
            background-color:  #d44e41;
            color:  #000000;
        }#T_dfdc4_row5_col6,#T_dfdc4_row6_col5{
            background-color:  #cd423b;
            color:  #f1f1f1;
        }#T_dfdc4_row5_col7{
            background-color:  #5a78e4;
            color:  #000000;
        }#T_dfdc4_row5_col8{
            background-color:  #5977e3;
            color:  #000000;
        }#T_dfdc4_row6_col0{
            background-color:  #e0dbd8;
            color:  #000000;
        }#T_dfdc4_row6_col1,#T_dfdc4_row7_col1{
            background-color:  #ccd9ed;
            color:  #000000;
        }#T_dfdc4_row6_col2{
            background-color:  #465ecf;
            color:  #f1f1f1;
        }#T_dfdc4_row6_col7{
            background-color:  #5d7ce6;
            color:  #000000;
        }#T_dfdc4_row6_col8{
            background-color:  #7597f6;
            color:  #000000;
        }#T_dfdc4_row7_col0{
            background-color:  #d5dbe5;
            color:  #000000;
        }#T_dfdc4_row7_col2{
            background-color:  #7699f6;
            color:  #000000;
        }#T_dfdc4_row7_col3{
            background-color:  #c4d5f3;
            color:  #000000;
        }#T_dfdc4_row7_col4{
            background-color:  #88abfd;
            color:  #000000;
        }#T_dfdc4_row7_col5{
            background-color:  #86a9fc;
            color:  #000000;
        }#T_dfdc4_row7_col8{
            background-color:  #f6a385;
            color:  #000000;
        }#T_dfdc4_row8_col0{
            background-color:  #d1dae9;
            color:  #000000;
        }#T_dfdc4_row8_col1{
            background-color:  #c1d4f4;
            color:  #000000;
        }#T_dfdc4_row8_col2{
            background-color:  #afcafc;
            color:  #000000;
        }#T_dfdc4_row8_col3{
            background-color:  #b5cdfa;
            color:  #000000;
        }#T_dfdc4_row8_col5{
            background-color:  #7ea1fa;
            color:  #000000;
        }#T_dfdc4_row8_col7{
            background-color:  #f7a688;
            color:  #000000;
        }</style>
<table id="T_dfdc4_" class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th"></th>
<th class="col_heading level0 col0" data-quarto-table-cell-role="th">longitude</th>
<th class="col_heading level0 col1" data-quarto-table-cell-role="th">latitude</th>
<th class="col_heading level0 col2" data-quarto-table-cell-role="th">housing_median_age</th>
<th class="col_heading level0 col3" data-quarto-table-cell-role="th">total_rooms</th>
<th class="col_heading level0 col4" data-quarto-table-cell-role="th">total_bedrooms</th>
<th class="col_heading level0 col5" data-quarto-table-cell-role="th">population</th>
<th class="col_heading level0 col6" data-quarto-table-cell-role="th">households</th>
<th class="col_heading level0 col7" data-quarto-table-cell-role="th">median_income</th>
<th class="col_heading level0 col8" data-quarto-table-cell-role="th">median_house_value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_dfdc4_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">longitude</td>
<td id="T_dfdc4_row0_col0" class="data row0 col0">1.00</td>
<td id="T_dfdc4_row0_col1" class="data row0 col1">-0.92</td>
<td id="T_dfdc4_row0_col2" class="data row0 col2">-0.11</td>
<td id="T_dfdc4_row0_col3" class="data row0 col3">0.05</td>
<td id="T_dfdc4_row0_col4" class="data row0 col4">0.08</td>
<td id="T_dfdc4_row0_col5" class="data row0 col5">0.11</td>
<td id="T_dfdc4_row0_col6" class="data row0 col6">0.06</td>
<td id="T_dfdc4_row0_col7" class="data row0 col7">-0.02</td>
<td id="T_dfdc4_row0_col8" class="data row0 col8">-0.05</td>
</tr>
<tr class="even">
<td id="T_dfdc4_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">latitude</td>
<td id="T_dfdc4_row1_col0" class="data row1 col0">-0.92</td>
<td id="T_dfdc4_row1_col1" class="data row1 col1">1.00</td>
<td id="T_dfdc4_row1_col2" class="data row1 col2">0.01</td>
<td id="T_dfdc4_row1_col3" class="data row1 col3">-0.04</td>
<td id="T_dfdc4_row1_col4" class="data row1 col4">-0.07</td>
<td id="T_dfdc4_row1_col5" class="data row1 col5">-0.12</td>
<td id="T_dfdc4_row1_col6" class="data row1 col6">-0.08</td>
<td id="T_dfdc4_row1_col7" class="data row1 col7">-0.08</td>
<td id="T_dfdc4_row1_col8" class="data row1 col8">-0.14</td>
</tr>
<tr class="odd">
<td id="T_dfdc4_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">housing_median_age</td>
<td id="T_dfdc4_row2_col0" class="data row2 col0">-0.11</td>
<td id="T_dfdc4_row2_col1" class="data row2 col1">0.01</td>
<td id="T_dfdc4_row2_col2" class="data row2 col2">1.00</td>
<td id="T_dfdc4_row2_col3" class="data row2 col3">-0.36</td>
<td id="T_dfdc4_row2_col4" class="data row2 col4">-0.33</td>
<td id="T_dfdc4_row2_col5" class="data row2 col5">-0.30</td>
<td id="T_dfdc4_row2_col6" class="data row2 col6">-0.31</td>
<td id="T_dfdc4_row2_col7" class="data row2 col7">-0.11</td>
<td id="T_dfdc4_row2_col8" class="data row2 col8">0.11</td>
</tr>
<tr class="even">
<td id="T_dfdc4_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">total_rooms</td>
<td id="T_dfdc4_row3_col0" class="data row3 col0">0.05</td>
<td id="T_dfdc4_row3_col1" class="data row3 col1">-0.04</td>
<td id="T_dfdc4_row3_col2" class="data row3 col2">-0.36</td>
<td id="T_dfdc4_row3_col3" class="data row3 col3">1.00</td>
<td id="T_dfdc4_row3_col4" class="data row3 col4">0.93</td>
<td id="T_dfdc4_row3_col5" class="data row3 col5">0.86</td>
<td id="T_dfdc4_row3_col6" class="data row3 col6">0.92</td>
<td id="T_dfdc4_row3_col7" class="data row3 col7">0.20</td>
<td id="T_dfdc4_row3_col8" class="data row3 col8">0.14</td>
</tr>
<tr class="odd">
<td id="T_dfdc4_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">total_bedrooms</td>
<td id="T_dfdc4_row4_col0" class="data row4 col0">0.08</td>
<td id="T_dfdc4_row4_col1" class="data row4 col1">-0.07</td>
<td id="T_dfdc4_row4_col2" class="data row4 col2">-0.33</td>
<td id="T_dfdc4_row4_col3" class="data row4 col3">0.93</td>
<td id="T_dfdc4_row4_col4" class="data row4 col4">1.00</td>
<td id="T_dfdc4_row4_col5" class="data row4 col5">0.88</td>
<td id="T_dfdc4_row4_col6" class="data row4 col6">0.98</td>
<td id="T_dfdc4_row4_col7" class="data row4 col7">-0.01</td>
<td id="T_dfdc4_row4_col8" class="data row4 col8">0.05</td>
</tr>
<tr class="even">
<td id="T_dfdc4_level0_row5" class="row_heading level0 row5" data-quarto-table-cell-role="th">population</td>
<td id="T_dfdc4_row5_col0" class="data row5 col0">0.11</td>
<td id="T_dfdc4_row5_col1" class="data row5 col1">-0.12</td>
<td id="T_dfdc4_row5_col2" class="data row5 col2">-0.30</td>
<td id="T_dfdc4_row5_col3" class="data row5 col3">0.86</td>
<td id="T_dfdc4_row5_col4" class="data row5 col4">0.88</td>
<td id="T_dfdc4_row5_col5" class="data row5 col5">1.00</td>
<td id="T_dfdc4_row5_col6" class="data row5 col6">0.90</td>
<td id="T_dfdc4_row5_col7" class="data row5 col7">0.00</td>
<td id="T_dfdc4_row5_col8" class="data row5 col8">-0.03</td>
</tr>
<tr class="odd">
<td id="T_dfdc4_level0_row6" class="row_heading level0 row6" data-quarto-table-cell-role="th">households</td>
<td id="T_dfdc4_row6_col0" class="data row6 col0">0.06</td>
<td id="T_dfdc4_row6_col1" class="data row6 col1">-0.08</td>
<td id="T_dfdc4_row6_col2" class="data row6 col2">-0.31</td>
<td id="T_dfdc4_row6_col3" class="data row6 col3">0.92</td>
<td id="T_dfdc4_row6_col4" class="data row6 col4">0.98</td>
<td id="T_dfdc4_row6_col5" class="data row6 col5">0.90</td>
<td id="T_dfdc4_row6_col6" class="data row6 col6">1.00</td>
<td id="T_dfdc4_row6_col7" class="data row6 col7">0.01</td>
<td id="T_dfdc4_row6_col8" class="data row6 col8">0.06</td>
</tr>
<tr class="even">
<td id="T_dfdc4_level0_row7" class="row_heading level0 row7" data-quarto-table-cell-role="th">median_income</td>
<td id="T_dfdc4_row7_col0" class="data row7 col0">-0.02</td>
<td id="T_dfdc4_row7_col1" class="data row7 col1">-0.08</td>
<td id="T_dfdc4_row7_col2" class="data row7 col2">-0.11</td>
<td id="T_dfdc4_row7_col3" class="data row7 col3">0.20</td>
<td id="T_dfdc4_row7_col4" class="data row7 col4">-0.01</td>
<td id="T_dfdc4_row7_col5" class="data row7 col5">0.00</td>
<td id="T_dfdc4_row7_col6" class="data row7 col6">0.01</td>
<td id="T_dfdc4_row7_col7" class="data row7 col7">1.00</td>
<td id="T_dfdc4_row7_col8" class="data row7 col8">0.69</td>
</tr>
<tr class="odd">
<td id="T_dfdc4_level0_row8" class="row_heading level0 row8" data-quarto-table-cell-role="th">median_house_value</td>
<td id="T_dfdc4_row8_col0" class="data row8 col0">-0.05</td>
<td id="T_dfdc4_row8_col1" class="data row8 col1">-0.14</td>
<td id="T_dfdc4_row8_col2" class="data row8 col2">0.11</td>
<td id="T_dfdc4_row8_col3" class="data row8 col3">0.14</td>
<td id="T_dfdc4_row8_col4" class="data row8 col4">0.05</td>
<td id="T_dfdc4_row8_col5" class="data row8 col5">-0.03</td>
<td id="T_dfdc4_row8_col6" class="data row8 col6">0.06</td>
<td id="T_dfdc4_row8_col7" class="data row8 col7">0.69</td>
<td id="T_dfdc4_row8_col8" class="data row8 col8">1.00</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-49" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>corr_matrix[<span class="st">'median_house_value'</span>].sort_values(ascending<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>latitude             -0.142724
longitude            -0.047432
population           -0.026920
total_bedrooms        0.047689
households            0.064506
housing_median_age    0.114110
total_rooms           0.135097
median_income         0.687160
median_house_value    1.000000
Name: median_house_value, dtype: float64</code></pre>
</div>
</div>
<p>The correlation matrix suggests the amount of correlation between a pair of variables. When close to 1 it means a strong +ve correlation whereas, -1 means an inverse correlation. Looking at the correlation between median_house_values and other variables, we can see that there’s some correlation with median_income (0.68 – so +ve), and with the latitude (-0.14 – so an inverse relation).</p>
<p>Another to check this relation is to plot scatter plots for each pair of variables in the dataset. Below we plot this for few potential/interesting variables</p>
<div id="cell-51" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># from pandas.tools.plotting import scatter_matrix # For older versions of Pandas</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas.plotting <span class="im">import</span> scatter_matrix</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>attributes <span class="op">=</span> [<span class="st">"median_house_value"</span>, <span class="st">"median_income"</span>, <span class="st">"total_rooms"</span>,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">"housing_median_age"</span>]</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>scatter_axes <span class="op">=</span> scatter_matrix(housing[attributes], figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))<span class="op">;</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co">#y labels</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>[plt.setp(item.yaxis.get_label(), <span class="st">'size'</span>, <span class="dv">10</span>) <span class="cf">for</span> item <span class="kw">in</span> scatter_axes.ravel()]<span class="op">;</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co">#x labels</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>[plt.setp(item.xaxis.get_label(), <span class="st">'size'</span>, <span class="dv">10</span>) <span class="cf">for</span> item <span class="kw">in</span> scatter_axes.ravel()]<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2019-08-02-end2endML_housing_files/figure-html/cell-32-output-1.png" width="733" height="498" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The diagonal entries show the histogram for each variable. We saw this previously for some variables. The most promising variable from this analysis seems to be the <code>median_income</code>.</p>
<div id="cell-53" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>housing.plot(kind<span class="op">=</span><span class="st">"scatter"</span>, x<span class="op">=</span><span class="st">"median_income"</span>, y<span class="op">=</span><span class="st">"median_house_value"</span>,</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>             alpha<span class="op">=</span><span class="fl">0.1</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>*c* argument looks like a single numeric RGB or RGBA sequence, which should be avoided as value-mapping will have precedence in case its length matches with *x* &amp; *y*.  Please use the *color* keyword-argument or provide a 2D array with a single row if you intend to specify the same RGB or RGBA value for all points.</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2019-08-02-end2endML_housing_files/figure-html/cell-33-output-2.png" width="434" height="277" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Plotting it shows the stronger correlation with the target variable i.e.&nbsp;median_house_value however we can see horizontal lines (especially at USD 500k, 450k 350k) these could be due to some stratifying done in the dataset implicitly. It would be better to remove those to ensure our model does not spuriously fit for those since they are some of the quirks in the data.</p>
</section>
</section>
<section id="experimenting-with-attributes" class="level3">
<h3 class="anchored" data-anchor-id="experimenting-with-attributes">Experimenting with attributes</h3>
<p>Before we began proposing models for the data. We can play around with the variables and try different combinations of them to see if we get better trends. Let’s look at a few. First, the total_room and/or total_bedroom variable could be changed to average_bedroom_per_house to better for bedrooms rather than looking for total bedroom in that district we would be looking at avg_bedroom per district and similarly we would do it for rooms.</p>
<div id="cell-56" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Average bedroom per house-holds in the district </span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>housing[<span class="st">'avg_bedroom'</span>]<span class="op">=</span>housing[<span class="st">'total_bedrooms'</span>]<span class="op">/</span>housing[<span class="st">'households'</span>]</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Average room per house-holds in the district </span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>housing[<span class="st">'avg_room'</span>]<span class="op">=</span>housing[<span class="st">'total_rooms'</span>]<span class="op">/</span>housing[<span class="st">'households'</span>]</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Average bedrooms per rooms in a given district</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>housing[<span class="st">'bedroom_per_room'</span>]<span class="op">=</span>housing[<span class="st">'total_bedrooms'</span>]<span class="op">/</span>housing[<span class="st">'total_rooms'</span>]</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Average population per household in a given district</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>housing[<span class="st">'population_per_household'</span>]<span class="op">=</span>housing[<span class="st">'population'</span>]<span class="op">/</span>housing[<span class="st">'households'</span>]</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Average room per population in a given district</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>housing[<span class="st">'room_per_popoulation'</span>]<span class="op">=</span>housing[<span class="st">'total_rooms'</span>]<span class="op">/</span>housing[<span class="st">'population'</span>]</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Average room per population in a given district</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>housing[<span class="st">'room_per_popoulation'</span>]<span class="op">=</span>housing[<span class="st">'total_rooms'</span>]<span class="op">/</span>housing[<span class="st">'population'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-57" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Making the correlation matrix again </span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>corr_matrix<span class="op">=</span>housing.corr()</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>corr_matrix.style.background_gradient(cmap<span class="op">=</span><span class="st">'coolwarm'</span>).set_precision(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<style type="text/css">
#T_132aa_row0_col0,#T_132aa_row1_col1,#T_132aa_row2_col2,#T_132aa_row3_col3,#T_132aa_row4_col4,#T_132aa_row5_col5,#T_132aa_row6_col6,#T_132aa_row7_col7,#T_132aa_row8_col8,#T_132aa_row9_col9,#T_132aa_row10_col10,#T_132aa_row11_col11,#T_132aa_row12_col12,#T_132aa_row13_col13{
            background-color:  #b40426;
            color:  #f1f1f1;
        }#T_132aa_row0_col1,#T_132aa_row1_col0,#T_132aa_row2_col3,#T_132aa_row2_col4,#T_132aa_row2_col5,#T_132aa_row2_col6,#T_132aa_row2_col9,#T_132aa_row3_col2,#T_132aa_row7_col11,#T_132aa_row11_col7,#T_132aa_row11_col8,#T_132aa_row11_col10,#T_132aa_row11_col13,#T_132aa_row13_col12{
            background-color:  #3b4cc0;
            color:  #f1f1f1;
        }#T_132aa_row0_col2,#T_132aa_row1_col4,#T_132aa_row9_col6,#T_132aa_row12_col8{
            background-color:  #779af7;
            color:  #000000;
        }#T_132aa_row0_col3,#T_132aa_row0_col4,#T_132aa_row3_col13{
            background-color:  #9fbfff;
            color:  #000000;
        }#T_132aa_row0_col5,#T_132aa_row1_col11,#T_132aa_row2_col7,#T_132aa_row3_col8{
            background-color:  #a3c2fe;
            color:  #000000;
        }#T_132aa_row0_col6,#T_132aa_row8_col4,#T_132aa_row8_col6,#T_132aa_row13_col4{
            background-color:  #98b9ff;
            color:  #000000;
        }#T_132aa_row0_col7{
            background-color:  #b7cff9;
            color:  #000000;
        }#T_132aa_row0_col8,#T_132aa_row10_col6{
            background-color:  #7093f3;
            color:  #000000;
        }#T_132aa_row0_col9{
            background-color:  #536edd;
            color:  #000000;
        }#T_132aa_row0_col10{
            background-color:  #92b4fe;
            color:  #000000;
        }#T_132aa_row0_col11,#T_132aa_row4_col1,#T_132aa_row13_col0{
            background-color:  #cdd9ec;
            color:  #000000;
        }#T_132aa_row0_col12,#T_132aa_row5_col2{
            background-color:  #4961d2;
            color:  #f1f1f1;
        }#T_132aa_row0_col13{
            background-color:  #6a8bef;
            color:  #000000;
        }#T_132aa_row1_col2{
            background-color:  #94b6ff;
            color:  #000000;
        }#T_132aa_row1_col3{
            background-color:  #89acfd;
            color:  #000000;
        }#T_132aa_row1_col5{
            background-color:  #6788ee;
            color:  #000000;
        }#T_132aa_row1_col6,#T_132aa_row9_col8,#T_132aa_row10_col5{
            background-color:  #7295f4;
            color:  #000000;
        }#T_132aa_row1_col7{
            background-color:  #abc8fd;
            color:  #000000;
        }#T_132aa_row1_col8{
            background-color:  #5673e0;
            color:  #000000;
        }#T_132aa_row1_col9{
            background-color:  #6485ec;
            color:  #000000;
        }#T_132aa_row1_col10,#T_132aa_row10_col3{
            background-color:  #b3cdfb;
            color:  #000000;
        }#T_132aa_row1_col12,#T_132aa_row11_col12{
            background-color:  #4a63d3;
            color:  #f1f1f1;
        }#T_132aa_row1_col13{
            background-color:  #a5c3fe;
            color:  #000000;
        }#T_132aa_row2_col0{
            background-color:  #c7d7f0;
            color:  #000000;
        }#T_132aa_row2_col1,#T_132aa_row12_col1{
            background-color:  #d8dce2;
            color:  #000000;
        }#T_132aa_row2_col8{
            background-color:  #9ebeff;
            color:  #000000;
        }#T_132aa_row2_col10{
            background-color:  #7597f6;
            color:  #000000;
        }#T_132aa_row2_col11,#T_132aa_row10_col0{
            background-color:  #d4dbe6;
            color:  #000000;
        }#T_132aa_row2_col12{
            background-color:  #4c66d6;
            color:  #000000;
        }#T_132aa_row2_col13{
            background-color:  #6180e9;
            color:  #000000;
        }#T_132aa_row3_col0,#T_132aa_row3_col7,#T_132aa_row7_col10{
            background-color:  #dedcdb;
            color:  #000000;
        }#T_132aa_row3_col1{
            background-color:  #d2dbe8;
            color:  #000000;
        }#T_132aa_row3_col4,#T_132aa_row4_col3{
            background-color:  #c73635;
            color:  #f1f1f1;
        }#T_132aa_row3_col5{
            background-color:  #d95847;
            color:  #000000;
        }#T_132aa_row3_col6,#T_132aa_row6_col3{
            background-color:  #ca3b37;
            color:  #f1f1f1;
        }#T_132aa_row3_col9,#T_132aa_row5_col13{
            background-color:  #5875e1;
            color:  #000000;
        }#T_132aa_row3_col10,#T_132aa_row4_col7{
            background-color:  #b9d0f9;
            color:  #000000;
        }#T_132aa_row3_col11{
            background-color:  #93b5fe;
            color:  #000000;
        }#T_132aa_row3_col12,#T_132aa_row8_col12{
            background-color:  #4257c9;
            color:  #f1f1f1;
        }#T_132aa_row4_col0{
            background-color:  #e2dad5;
            color:  #000000;
        }#T_132aa_row4_col2,#T_132aa_row8_col9{
            background-color:  #4358cb;
            color:  #f1f1f1;
        }#T_132aa_row4_col5{
            background-color:  #d55042;
            color:  #000000;
        }#T_132aa_row4_col6,#T_132aa_row6_col4{
            background-color:  #b8122a;
            color:  #f1f1f1;
        }#T_132aa_row4_col8,#T_132aa_row4_col13,#T_132aa_row7_col6,#T_132aa_row10_col4{
            background-color:  #8badfd;
            color:  #000000;
        }#T_132aa_row4_col9{
            background-color:  #5d7ce6;
            color:  #000000;
        }#T_132aa_row4_col10,#T_132aa_row9_col3,#T_132aa_row11_col6,#T_132aa_row12_col5{
            background-color:  #9abbff;
            color:  #000000;
        }#T_132aa_row4_col11,#T_132aa_row6_col1,#T_132aa_row7_col1{
            background-color:  #ccd9ed;
            color:  #000000;
        }#T_132aa_row4_col12,#T_132aa_row6_col12{
            background-color:  #4055c8;
            color:  #f1f1f1;
        }#T_132aa_row5_col0,#T_132aa_row10_col1{
            background-color:  #e6d7cf;
            color:  #000000;
        }#T_132aa_row5_col1,#T_132aa_row11_col1{
            background-color:  #c6d6f1;
            color:  #000000;
        }#T_132aa_row5_col3{
            background-color:  #d85646;
            color:  #000000;
        }#T_132aa_row5_col4{
            background-color:  #d44e41;
            color:  #000000;
        }#T_132aa_row5_col6,#T_132aa_row6_col5{
            background-color:  #cd423b;
            color:  #f1f1f1;
        }#T_132aa_row5_col7{
            background-color:  #bbd1f8;
            color:  #000000;
        }#T_132aa_row5_col8,#T_132aa_row7_col2{
            background-color:  #7699f6;
            color:  #000000;
        }#T_132aa_row5_col9{
            background-color:  #3c4ec2;
            color:  #f1f1f1;
        }#T_132aa_row5_col10,#T_132aa_row7_col5{
            background-color:  #86a9fc;
            color:  #000000;
        }#T_132aa_row5_col11{
            background-color:  #c3d5f4;
            color:  #000000;
        }#T_132aa_row5_col12,#T_132aa_row11_col9,#T_132aa_row13_col5{
            background-color:  #5f7fe8;
            color:  #000000;
        }#T_132aa_row6_col0{
            background-color:  #e0dbd8;
            color:  #000000;
        }#T_132aa_row6_col2,#T_132aa_row9_col12,#T_132aa_row10_col12{
            background-color:  #465ecf;
            color:  #f1f1f1;
        }#T_132aa_row6_col7{
            background-color:  #bed2f6;
            color:  #000000;
        }#T_132aa_row6_col8{
            background-color:  #8fb1fe;
            color:  #000000;
        }#T_132aa_row6_col9{
            background-color:  #3f53c6;
            color:  #f1f1f1;
        }#T_132aa_row6_col10,#T_132aa_row8_col11,#T_132aa_row12_col4,#T_132aa_row13_col11{
            background-color:  #84a7fc;
            color:  #000000;
        }#T_132aa_row6_col11{
            background-color:  #c9d7f0;
            color:  #000000;
        }#T_132aa_row6_col13,#T_132aa_row9_col5{
            background-color:  #7396f5;
            color:  #000000;
        }#T_132aa_row7_col0{
            background-color:  #d5dbe5;
            color:  #000000;
        }#T_132aa_row7_col3{
            background-color:  #c4d5f3;
            color:  #000000;
        }#T_132aa_row7_col4{
            background-color:  #88abfd;
            color:  #000000;
        }#T_132aa_row7_col8{
            background-color:  #f4987a;
            color:  #000000;
        }#T_132aa_row7_col9{
            background-color:  #3e51c5;
            color:  #f1f1f1;
        }#T_132aa_row7_col12{
            background-color:  #4f69d9;
            color:  #000000;
        }#T_132aa_row7_col13,#T_132aa_row8_col10,#T_132aa_row12_col11{
            background-color:  #bcd2f7;
            color:  #000000;
        }#T_132aa_row8_col0{
            background-color:  #d1dae9;
            color:  #000000;
        }#T_132aa_row8_col1{
            background-color:  #c1d4f4;
            color:  #000000;
        }#T_132aa_row8_col2,#T_132aa_row9_col7{
            background-color:  #afcafc;
            color:  #000000;
        }#T_132aa_row8_col3,#T_132aa_row8_col13,#T_132aa_row13_col8{
            background-color:  #b5cdfa;
            color:  #000000;
        }#T_132aa_row8_col5,#T_132aa_row13_col6{
            background-color:  #7ea1fa;
            color:  #000000;
        }#T_132aa_row8_col7{
            background-color:  #ec8165;
            color:  #000000;
        }#T_132aa_row9_col0{
            background-color:  #d9dce1;
            color:  #000000;
        }#T_132aa_row9_col1{
            background-color:  #e1dad6;
            color:  #000000;
        }#T_132aa_row9_col2,#T_132aa_row12_col6{
            background-color:  #80a3fa;
            color:  #000000;
        }#T_132aa_row9_col4,#T_132aa_row12_col2,#T_132aa_row12_col10{
            background-color:  #97b8ff;
            color:  #000000;
        }#T_132aa_row9_col10{
            background-color:  #d65244;
            color:  #000000;
        }#T_132aa_row9_col11{
            background-color:  #c5d6f2;
            color:  #000000;
        }#T_132aa_row9_col13,#T_132aa_row10_col9{
            background-color:  #de614d;
            color:  #000000;
        }#T_132aa_row10_col2{
            background-color:  #6c8ff1;
            color:  #000000;
        }#T_132aa_row10_col7{
            background-color:  #eed0c0;
            color:  #000000;
        }#T_132aa_row10_col8{
            background-color:  #a6c4fe;
            color:  #000000;
        }#T_132aa_row10_col11{
            background-color:  #6687ed;
            color:  #000000;
        }#T_132aa_row10_col13{
            background-color:  #d1493f;
            color:  #f1f1f1;
        }#T_132aa_row11_col0{
            background-color:  #e4d9d2;
            color:  #000000;
        }#T_132aa_row11_col2{
            background-color:  #b6cefa;
            color:  #000000;
        }#T_132aa_row11_col3{
            background-color:  #6282ea;
            color:  #000000;
        }#T_132aa_row11_col4{
            background-color:  #a2c1ff;
            color:  #000000;
        }#T_132aa_row11_col5{
            background-color:  #90b2fe;
            color:  #000000;
        }#T_132aa_row12_col0{
            background-color:  #d7dce3;
            color:  #000000;
        }#T_132aa_row12_col3{
            background-color:  #8caffe;
            color:  #000000;
        }#T_132aa_row12_col7{
            background-color:  #bfd3f6;
            color:  #000000;
        }#T_132aa_row12_col9{
            background-color:  #4e68d8;
            color:  #000000;
        }#T_132aa_row12_col13{
            background-color:  #6f92f3;
            color:  #000000;
        }#T_132aa_row13_col1{
            background-color:  #ead5c9;
            color:  #000000;
        }#T_132aa_row13_col2{
            background-color:  #799cf8;
            color:  #000000;
        }#T_132aa_row13_col3{
            background-color:  #b1cbfc;
            color:  #000000;
        }#T_132aa_row13_col7{
            background-color:  #e3d9d3;
            color:  #000000;
        }#T_132aa_row13_col9{
            background-color:  #e36c55;
            color:  #000000;
        }#T_132aa_row13_col10{
            background-color:  #cf453c;
            color:  #f1f1f1;
        }</style>
<table id="T_132aa_" class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th"></th>
<th class="col_heading level0 col0" data-quarto-table-cell-role="th">longitude</th>
<th class="col_heading level0 col1" data-quarto-table-cell-role="th">latitude</th>
<th class="col_heading level0 col2" data-quarto-table-cell-role="th">housing_median_age</th>
<th class="col_heading level0 col3" data-quarto-table-cell-role="th">total_rooms</th>
<th class="col_heading level0 col4" data-quarto-table-cell-role="th">total_bedrooms</th>
<th class="col_heading level0 col5" data-quarto-table-cell-role="th">population</th>
<th class="col_heading level0 col6" data-quarto-table-cell-role="th">households</th>
<th class="col_heading level0 col7" data-quarto-table-cell-role="th">median_income</th>
<th class="col_heading level0 col8" data-quarto-table-cell-role="th">median_house_value</th>
<th class="col_heading level0 col9" data-quarto-table-cell-role="th">avg_bedroom</th>
<th class="col_heading level0 col10" data-quarto-table-cell-role="th">avg_room</th>
<th class="col_heading level0 col11" data-quarto-table-cell-role="th">bedroom_per_room</th>
<th class="col_heading level0 col12" data-quarto-table-cell-role="th">population_per_household</th>
<th class="col_heading level0 col13" data-quarto-table-cell-role="th">room_per_popoulation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_132aa_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">longitude</td>
<td id="T_132aa_row0_col0" class="data row0 col0">1.00</td>
<td id="T_132aa_row0_col1" class="data row0 col1">-0.92</td>
<td id="T_132aa_row0_col2" class="data row0 col2">-0.11</td>
<td id="T_132aa_row0_col3" class="data row0 col3">0.05</td>
<td id="T_132aa_row0_col4" class="data row0 col4">0.08</td>
<td id="T_132aa_row0_col5" class="data row0 col5">0.11</td>
<td id="T_132aa_row0_col6" class="data row0 col6">0.06</td>
<td id="T_132aa_row0_col7" class="data row0 col7">-0.02</td>
<td id="T_132aa_row0_col8" class="data row0 col8">-0.05</td>
<td id="T_132aa_row0_col9" class="data row0 col9">0.01</td>
<td id="T_132aa_row0_col10" class="data row0 col10">-0.03</td>
<td id="T_132aa_row0_col11" class="data row0 col11">0.10</td>
<td id="T_132aa_row0_col12" class="data row0 col12">-0.00</td>
<td id="T_132aa_row0_col13" class="data row0 col13">-0.07</td>
</tr>
<tr class="even">
<td id="T_132aa_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">latitude</td>
<td id="T_132aa_row1_col0" class="data row1 col0">-0.92</td>
<td id="T_132aa_row1_col1" class="data row1 col1">1.00</td>
<td id="T_132aa_row1_col2" class="data row1 col2">0.01</td>
<td id="T_132aa_row1_col3" class="data row1 col3">-0.04</td>
<td id="T_132aa_row1_col4" class="data row1 col4">-0.07</td>
<td id="T_132aa_row1_col5" class="data row1 col5">-0.12</td>
<td id="T_132aa_row1_col6" class="data row1 col6">-0.08</td>
<td id="T_132aa_row1_col7" class="data row1 col7">-0.08</td>
<td id="T_132aa_row1_col8" class="data row1 col8">-0.14</td>
<td id="T_132aa_row1_col9" class="data row1 col9">0.07</td>
<td id="T_132aa_row1_col10" class="data row1 col10">0.11</td>
<td id="T_132aa_row1_col11" class="data row1 col11">-0.12</td>
<td id="T_132aa_row1_col12" class="data row1 col12">0.01</td>
<td id="T_132aa_row1_col13" class="data row1 col13">0.14</td>
</tr>
<tr class="odd">
<td id="T_132aa_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">housing_median_age</td>
<td id="T_132aa_row2_col0" class="data row2 col0">-0.11</td>
<td id="T_132aa_row2_col1" class="data row2 col1">0.01</td>
<td id="T_132aa_row2_col2" class="data row2 col2">1.00</td>
<td id="T_132aa_row2_col3" class="data row2 col3">-0.36</td>
<td id="T_132aa_row2_col4" class="data row2 col4">-0.33</td>
<td id="T_132aa_row2_col5" class="data row2 col5">-0.30</td>
<td id="T_132aa_row2_col6" class="data row2 col6">-0.31</td>
<td id="T_132aa_row2_col7" class="data row2 col7">-0.11</td>
<td id="T_132aa_row2_col8" class="data row2 col8">0.11</td>
<td id="T_132aa_row2_col9" class="data row2 col9">-0.08</td>
<td id="T_132aa_row2_col10" class="data row2 col10">-0.15</td>
<td id="T_132aa_row2_col11" class="data row2 col11">0.14</td>
<td id="T_132aa_row2_col12" class="data row2 col12">0.02</td>
<td id="T_132aa_row2_col13" class="data row2 col13">-0.10</td>
</tr>
<tr class="even">
<td id="T_132aa_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">total_rooms</td>
<td id="T_132aa_row3_col0" class="data row3 col0">0.05</td>
<td id="T_132aa_row3_col1" class="data row3 col1">-0.04</td>
<td id="T_132aa_row3_col2" class="data row3 col2">-0.36</td>
<td id="T_132aa_row3_col3" class="data row3 col3">1.00</td>
<td id="T_132aa_row3_col4" class="data row3 col4">0.93</td>
<td id="T_132aa_row3_col5" class="data row3 col5">0.86</td>
<td id="T_132aa_row3_col6" class="data row3 col6">0.92</td>
<td id="T_132aa_row3_col7" class="data row3 col7">0.20</td>
<td id="T_132aa_row3_col8" class="data row3 col8">0.14</td>
<td id="T_132aa_row3_col9" class="data row3 col9">0.03</td>
<td id="T_132aa_row3_col10" class="data row3 col10">0.13</td>
<td id="T_132aa_row3_col11" class="data row3 col11">-0.19</td>
<td id="T_132aa_row3_col12" class="data row3 col12">-0.02</td>
<td id="T_132aa_row3_col13" class="data row3 col13">0.12</td>
</tr>
<tr class="odd">
<td id="T_132aa_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">total_bedrooms</td>
<td id="T_132aa_row4_col0" class="data row4 col0">0.08</td>
<td id="T_132aa_row4_col1" class="data row4 col1">-0.07</td>
<td id="T_132aa_row4_col2" class="data row4 col2">-0.33</td>
<td id="T_132aa_row4_col3" class="data row4 col3">0.93</td>
<td id="T_132aa_row4_col4" class="data row4 col4">1.00</td>
<td id="T_132aa_row4_col5" class="data row4 col5">0.88</td>
<td id="T_132aa_row4_col6" class="data row4 col6">0.98</td>
<td id="T_132aa_row4_col7" class="data row4 col7">-0.01</td>
<td id="T_132aa_row4_col8" class="data row4 col8">0.05</td>
<td id="T_132aa_row4_col9" class="data row4 col9">0.04</td>
<td id="T_132aa_row4_col10" class="data row4 col10">0.00</td>
<td id="T_132aa_row4_col11" class="data row4 col11">0.09</td>
<td id="T_132aa_row4_col12" class="data row4 col12">-0.03</td>
<td id="T_132aa_row4_col13" class="data row4 col13">0.05</td>
</tr>
<tr class="even">
<td id="T_132aa_level0_row5" class="row_heading level0 row5" data-quarto-table-cell-role="th">population</td>
<td id="T_132aa_row5_col0" class="data row5 col0">0.11</td>
<td id="T_132aa_row5_col1" class="data row5 col1">-0.12</td>
<td id="T_132aa_row5_col2" class="data row5 col2">-0.30</td>
<td id="T_132aa_row5_col3" class="data row5 col3">0.86</td>
<td id="T_132aa_row5_col4" class="data row5 col4">0.88</td>
<td id="T_132aa_row5_col5" class="data row5 col5">1.00</td>
<td id="T_132aa_row5_col6" class="data row5 col6">0.90</td>
<td id="T_132aa_row5_col7" class="data row5 col7">0.00</td>
<td id="T_132aa_row5_col8" class="data row5 col8">-0.03</td>
<td id="T_132aa_row5_col9" class="data row5 col9">-0.07</td>
<td id="T_132aa_row5_col10" class="data row5 col10">-0.07</td>
<td id="T_132aa_row5_col11" class="data row5 col11">0.04</td>
<td id="T_132aa_row5_col12" class="data row5 col12">0.08</td>
<td id="T_132aa_row5_col13" class="data row5 col13">-0.14</td>
</tr>
<tr class="odd">
<td id="T_132aa_level0_row6" class="row_heading level0 row6" data-quarto-table-cell-role="th">households</td>
<td id="T_132aa_row6_col0" class="data row6 col0">0.06</td>
<td id="T_132aa_row6_col1" class="data row6 col1">-0.08</td>
<td id="T_132aa_row6_col2" class="data row6 col2">-0.31</td>
<td id="T_132aa_row6_col3" class="data row6 col3">0.92</td>
<td id="T_132aa_row6_col4" class="data row6 col4">0.98</td>
<td id="T_132aa_row6_col5" class="data row6 col5">0.90</td>
<td id="T_132aa_row6_col6" class="data row6 col6">1.00</td>
<td id="T_132aa_row6_col7" class="data row6 col7">0.01</td>
<td id="T_132aa_row6_col8" class="data row6 col8">0.06</td>
<td id="T_132aa_row6_col9" class="data row6 col9">-0.06</td>
<td id="T_132aa_row6_col10" class="data row6 col10">-0.08</td>
<td id="T_132aa_row6_col11" class="data row6 col11">0.07</td>
<td id="T_132aa_row6_col12" class="data row6 col12">-0.03</td>
<td id="T_132aa_row6_col13" class="data row6 col13">-0.04</td>
</tr>
<tr class="even">
<td id="T_132aa_level0_row7" class="row_heading level0 row7" data-quarto-table-cell-role="th">median_income</td>
<td id="T_132aa_row7_col0" class="data row7 col0">-0.02</td>
<td id="T_132aa_row7_col1" class="data row7 col1">-0.08</td>
<td id="T_132aa_row7_col2" class="data row7 col2">-0.11</td>
<td id="T_132aa_row7_col3" class="data row7 col3">0.20</td>
<td id="T_132aa_row7_col4" class="data row7 col4">-0.01</td>
<td id="T_132aa_row7_col5" class="data row7 col5">0.00</td>
<td id="T_132aa_row7_col6" class="data row7 col6">0.01</td>
<td id="T_132aa_row7_col7" class="data row7 col7">1.00</td>
<td id="T_132aa_row7_col8" class="data row7 col8">0.69</td>
<td id="T_132aa_row7_col9" class="data row7 col9">-0.06</td>
<td id="T_132aa_row7_col10" class="data row7 col10">0.31</td>
<td id="T_132aa_row7_col11" class="data row7 col11">-0.62</td>
<td id="T_132aa_row7_col12" class="data row7 col12">0.02</td>
<td id="T_132aa_row7_col13" class="data row7 col13">0.23</td>
</tr>
<tr class="odd">
<td id="T_132aa_level0_row8" class="row_heading level0 row8" data-quarto-table-cell-role="th">median_house_value</td>
<td id="T_132aa_row8_col0" class="data row8 col0">-0.05</td>
<td id="T_132aa_row8_col1" class="data row8 col1">-0.14</td>
<td id="T_132aa_row8_col2" class="data row8 col2">0.11</td>
<td id="T_132aa_row8_col3" class="data row8 col3">0.14</td>
<td id="T_132aa_row8_col4" class="data row8 col4">0.05</td>
<td id="T_132aa_row8_col5" class="data row8 col5">-0.03</td>
<td id="T_132aa_row8_col6" class="data row8 col6">0.06</td>
<td id="T_132aa_row8_col7" class="data row8 col7">0.69</td>
<td id="T_132aa_row8_col8" class="data row8 col8">1.00</td>
<td id="T_132aa_row8_col9" class="data row8 col9">-0.04</td>
<td id="T_132aa_row8_col10" class="data row8 col10">0.15</td>
<td id="T_132aa_row8_col11" class="data row8 col11">-0.26</td>
<td id="T_132aa_row8_col12" class="data row8 col12">-0.02</td>
<td id="T_132aa_row8_col13" class="data row8 col13">0.20</td>
</tr>
<tr class="even">
<td id="T_132aa_level0_row9" class="row_heading level0 row9" data-quarto-table-cell-role="th">avg_bedroom</td>
<td id="T_132aa_row9_col0" class="data row9 col0">0.01</td>
<td id="T_132aa_row9_col1" class="data row9 col1">0.07</td>
<td id="T_132aa_row9_col2" class="data row9 col2">-0.08</td>
<td id="T_132aa_row9_col3" class="data row9 col3">0.03</td>
<td id="T_132aa_row9_col4" class="data row9 col4">0.04</td>
<td id="T_132aa_row9_col5" class="data row9 col5">-0.07</td>
<td id="T_132aa_row9_col6" class="data row9 col6">-0.06</td>
<td id="T_132aa_row9_col7" class="data row9 col7">-0.06</td>
<td id="T_132aa_row9_col8" class="data row9 col8">-0.04</td>
<td id="T_132aa_row9_col9" class="data row9 col9">1.00</td>
<td id="T_132aa_row9_col10" class="data row9 col10">0.86</td>
<td id="T_132aa_row9_col11" class="data row9 col11">0.05</td>
<td id="T_132aa_row9_col12" class="data row9 col12">-0.01</td>
<td id="T_132aa_row9_col13" class="data row9 col13">0.84</td>
</tr>
<tr class="odd">
<td id="T_132aa_level0_row10" class="row_heading level0 row10" data-quarto-table-cell-role="th">avg_room</td>
<td id="T_132aa_row10_col0" class="data row10 col0">-0.03</td>
<td id="T_132aa_row10_col1" class="data row10 col1">0.11</td>
<td id="T_132aa_row10_col2" class="data row10 col2">-0.15</td>
<td id="T_132aa_row10_col3" class="data row10 col3">0.13</td>
<td id="T_132aa_row10_col4" class="data row10 col4">0.00</td>
<td id="T_132aa_row10_col5" class="data row10 col5">-0.07</td>
<td id="T_132aa_row10_col6" class="data row10 col6">-0.08</td>
<td id="T_132aa_row10_col7" class="data row10 col7">0.31</td>
<td id="T_132aa_row10_col8" class="data row10 col8">0.15</td>
<td id="T_132aa_row10_col9" class="data row10 col9">0.86</td>
<td id="T_132aa_row10_col10" class="data row10 col10">1.00</td>
<td id="T_132aa_row10_col11" class="data row10 col11">-0.40</td>
<td id="T_132aa_row10_col12" class="data row10 col12">-0.01</td>
<td id="T_132aa_row10_col13" class="data row10 col13">0.90</td>
</tr>
<tr class="even">
<td id="T_132aa_level0_row11" class="row_heading level0 row11" data-quarto-table-cell-role="th">bedroom_per_room</td>
<td id="T_132aa_row11_col0" class="data row11 col0">0.10</td>
<td id="T_132aa_row11_col1" class="data row11 col1">-0.12</td>
<td id="T_132aa_row11_col2" class="data row11 col2">0.14</td>
<td id="T_132aa_row11_col3" class="data row11 col3">-0.19</td>
<td id="T_132aa_row11_col4" class="data row11 col4">0.09</td>
<td id="T_132aa_row11_col5" class="data row11 col5">0.04</td>
<td id="T_132aa_row11_col6" class="data row11 col6">0.07</td>
<td id="T_132aa_row11_col7" class="data row11 col7">-0.62</td>
<td id="T_132aa_row11_col8" class="data row11 col8">-0.26</td>
<td id="T_132aa_row11_col9" class="data row11 col9">0.05</td>
<td id="T_132aa_row11_col10" class="data row11 col10">-0.40</td>
<td id="T_132aa_row11_col11" class="data row11 col11">1.00</td>
<td id="T_132aa_row11_col12" class="data row11 col12">0.00</td>
<td id="T_132aa_row11_col13" class="data row11 col13">-0.26</td>
</tr>
<tr class="odd">
<td id="T_132aa_level0_row12" class="row_heading level0 row12" data-quarto-table-cell-role="th">population_per_household</td>
<td id="T_132aa_row12_col0" class="data row12 col0">-0.00</td>
<td id="T_132aa_row12_col1" class="data row12 col1">0.01</td>
<td id="T_132aa_row12_col2" class="data row12 col2">0.02</td>
<td id="T_132aa_row12_col3" class="data row12 col3">-0.02</td>
<td id="T_132aa_row12_col4" class="data row12 col4">-0.03</td>
<td id="T_132aa_row12_col5" class="data row12 col5">0.08</td>
<td id="T_132aa_row12_col6" class="data row12 col6">-0.03</td>
<td id="T_132aa_row12_col7" class="data row12 col7">0.02</td>
<td id="T_132aa_row12_col8" class="data row12 col8">-0.02</td>
<td id="T_132aa_row12_col9" class="data row12 col9">-0.01</td>
<td id="T_132aa_row12_col10" class="data row12 col10">-0.01</td>
<td id="T_132aa_row12_col11" class="data row12 col11">0.00</td>
<td id="T_132aa_row12_col12" class="data row12 col12">1.00</td>
<td id="T_132aa_row12_col13" class="data row12 col13">-0.05</td>
</tr>
<tr class="even">
<td id="T_132aa_level0_row13" class="row_heading level0 row13" data-quarto-table-cell-role="th">room_per_popoulation</td>
<td id="T_132aa_row13_col0" class="data row13 col0">-0.07</td>
<td id="T_132aa_row13_col1" class="data row13 col1">0.14</td>
<td id="T_132aa_row13_col2" class="data row13 col2">-0.10</td>
<td id="T_132aa_row13_col3" class="data row13 col3">0.12</td>
<td id="T_132aa_row13_col4" class="data row13 col4">0.05</td>
<td id="T_132aa_row13_col5" class="data row13 col5">-0.14</td>
<td id="T_132aa_row13_col6" class="data row13 col6">-0.04</td>
<td id="T_132aa_row13_col7" class="data row13 col7">0.23</td>
<td id="T_132aa_row13_col8" class="data row13 col8">0.20</td>
<td id="T_132aa_row13_col9" class="data row13 col9">0.84</td>
<td id="T_132aa_row13_col10" class="data row13 col10">0.90</td>
<td id="T_132aa_row13_col11" class="data row13 col11">-0.26</td>
<td id="T_132aa_row13_col12" class="data row13 col12">-0.05</td>
<td id="T_132aa_row13_col13" class="data row13 col13">1.00</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-58" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>corr_matrix[<span class="st">'median_house_value'</span>].sort_values(ascending<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>bedroom_per_room           -0.259984
latitude                   -0.142724
longitude                  -0.047432
avg_bedroom                -0.043343
population                 -0.026920
population_per_household   -0.021985
total_bedrooms              0.047689
households                  0.064506
housing_median_age          0.114110
total_rooms                 0.135097
avg_room                    0.146285
room_per_popoulation        0.199429
median_income               0.687160
median_house_value          1.000000
Name: median_house_value, dtype: float64</code></pre>
</div>
</div>
<p>This is interesting! We see that <code>bedroom_per_room</code> is another potential descriptor with negative corelation moreover we get <code>room_per_population</code> and <code>avg_room</code> to be decent new descriptors for the <code>median_house_value</code>. Not bad for a simple math manipulation to better represent the data. This is a crucial step and where domain knowledge and intuition would come handy.</p>
</section>
<section id="data-cleaning-and-prepping" class="level3">
<h3 class="anchored" data-anchor-id="data-cleaning-and-prepping">Data cleaning and prepping</h3>
<ol type="1">
<li>Separate the predictors and the target values</li>
<li>Write functions to conduct various data transformations ensuring consistency and ease</li>
<li>Make sure the data is devoid of any NaN values since that would raise warning and errors. We have three strategies we can implement here:
<ol type="a">
<li>Get rid of those points (districts) entirely</li>
<li>Get rid of whole attribute</li>
<li>Set missing values to either zero or one of the averages (mean, median, or mode)</li>
</ol></li>
</ol>
<p>In our case, total bedrooms had some missing values.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Option a:</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>housing.dropna(subset<span class="op">=</span>[<span class="st">"total_bedrooms"</span>])</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Option b:</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>housing.drop(<span class="st">"total_bedrooms"</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Option c:</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>median <span class="op">=</span> housing[<span class="st">"total_bedrooms"</span>].median()</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>housing[<span class="st">"total_bedrooms"</span>].fillna(median, inplace<span class="op">=</span><span class="va">True</span>) <span class="co"># option 3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Before we do any of this let’s first separate the predictor and target_values</p>
<div id="cell-61" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>housing <span class="op">=</span> strat_train_set.drop(<span class="st">"median_house_value"</span>, axis<span class="op">=</span><span class="dv">1</span>) <span class="co"># drop labels for training set</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>housing_labels <span class="op">=</span> strat_train_set[<span class="st">"median_house_value"</span>].copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-62" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Checking the NULL enties in the dataset</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>sample_incomplete_rows <span class="op">=</span> housing[housing.isnull().<span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)].head()</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>sample_incomplete_rows</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">housing_median_age</th>
<th data-quarto-table-cell-role="th">total_rooms</th>
<th data-quarto-table-cell-role="th">total_bedrooms</th>
<th data-quarto-table-cell-role="th">population</th>
<th data-quarto-table-cell-role="th">households</th>
<th data-quarto-table-cell-role="th">median_income</th>
<th data-quarto-table-cell-role="th">ocean_proximity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">4629</td>
<td>-118.30</td>
<td>34.07</td>
<td>18.0</td>
<td>3759.0</td>
<td>NaN</td>
<td>3296.0</td>
<td>1462.0</td>
<td>2.2708</td>
<td>&lt;1H OCEAN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6068</td>
<td>-117.86</td>
<td>34.01</td>
<td>16.0</td>
<td>4632.0</td>
<td>NaN</td>
<td>3038.0</td>
<td>727.0</td>
<td>5.1762</td>
<td>&lt;1H OCEAN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">17923</td>
<td>-121.97</td>
<td>37.35</td>
<td>30.0</td>
<td>1955.0</td>
<td>NaN</td>
<td>999.0</td>
<td>386.0</td>
<td>4.6328</td>
<td>&lt;1H OCEAN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13656</td>
<td>-117.30</td>
<td>34.05</td>
<td>6.0</td>
<td>2155.0</td>
<td>NaN</td>
<td>1039.0</td>
<td>391.0</td>
<td>1.6675</td>
<td>INLAND</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19252</td>
<td>-122.79</td>
<td>38.48</td>
<td>7.0</td>
<td>6837.0</td>
<td>NaN</td>
<td>3468.0</td>
<td>1405.0</td>
<td>3.1662</td>
<td>&lt;1H OCEAN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-63" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>sample_incomplete_rows.dropna(subset<span class="op">=</span>[<span class="st">"total_bedrooms"</span>])    <span class="co"># option 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">housing_median_age</th>
<th data-quarto-table-cell-role="th">total_rooms</th>
<th data-quarto-table-cell-role="th">total_bedrooms</th>
<th data-quarto-table-cell-role="th">population</th>
<th data-quarto-table-cell-role="th">households</th>
<th data-quarto-table-cell-role="th">median_income</th>
<th data-quarto-table-cell-role="th">ocean_proximity</th>
</tr>
</thead>
<tbody>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-64" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>sample_incomplete_rows.drop(<span class="st">"total_bedrooms"</span>, axis<span class="op">=</span><span class="dv">1</span>)   <span class="co">#option 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">housing_median_age</th>
<th data-quarto-table-cell-role="th">total_rooms</th>
<th data-quarto-table-cell-role="th">population</th>
<th data-quarto-table-cell-role="th">households</th>
<th data-quarto-table-cell-role="th">median_income</th>
<th data-quarto-table-cell-role="th">ocean_proximity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">4629</td>
<td>-118.30</td>
<td>34.07</td>
<td>18.0</td>
<td>3759.0</td>
<td>3296.0</td>
<td>1462.0</td>
<td>2.2708</td>
<td>&lt;1H OCEAN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6068</td>
<td>-117.86</td>
<td>34.01</td>
<td>16.0</td>
<td>4632.0</td>
<td>3038.0</td>
<td>727.0</td>
<td>5.1762</td>
<td>&lt;1H OCEAN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">17923</td>
<td>-121.97</td>
<td>37.35</td>
<td>30.0</td>
<td>1955.0</td>
<td>999.0</td>
<td>386.0</td>
<td>4.6328</td>
<td>&lt;1H OCEAN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13656</td>
<td>-117.30</td>
<td>34.05</td>
<td>6.0</td>
<td>2155.0</td>
<td>1039.0</td>
<td>391.0</td>
<td>1.6675</td>
<td>INLAND</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19252</td>
<td>-122.79</td>
<td>38.48</td>
<td>7.0</td>
<td>6837.0</td>
<td>3468.0</td>
<td>1405.0</td>
<td>3.1662</td>
<td>&lt;1H OCEAN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-65" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>median <span class="op">=</span> housing[<span class="st">"total_bedrooms"</span>].median()</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>sample_incomplete_rows[<span class="st">"total_bedrooms"</span>].fillna(median, inplace<span class="op">=</span><span class="va">True</span>) <span class="co"># option 3</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>sample_incomplete_rows</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">housing_median_age</th>
<th data-quarto-table-cell-role="th">total_rooms</th>
<th data-quarto-table-cell-role="th">total_bedrooms</th>
<th data-quarto-table-cell-role="th">population</th>
<th data-quarto-table-cell-role="th">households</th>
<th data-quarto-table-cell-role="th">median_income</th>
<th data-quarto-table-cell-role="th">ocean_proximity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">4629</td>
<td>-118.30</td>
<td>34.07</td>
<td>18.0</td>
<td>3759.0</td>
<td>433.0</td>
<td>3296.0</td>
<td>1462.0</td>
<td>2.2708</td>
<td>&lt;1H OCEAN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6068</td>
<td>-117.86</td>
<td>34.01</td>
<td>16.0</td>
<td>4632.0</td>
<td>433.0</td>
<td>3038.0</td>
<td>727.0</td>
<td>5.1762</td>
<td>&lt;1H OCEAN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">17923</td>
<td>-121.97</td>
<td>37.35</td>
<td>30.0</td>
<td>1955.0</td>
<td>433.0</td>
<td>999.0</td>
<td>386.0</td>
<td>4.6328</td>
<td>&lt;1H OCEAN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13656</td>
<td>-117.30</td>
<td>34.05</td>
<td>6.0</td>
<td>2155.0</td>
<td>433.0</td>
<td>1039.0</td>
<td>391.0</td>
<td>1.6675</td>
<td>INLAND</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19252</td>
<td>-122.79</td>
<td>38.48</td>
<td>7.0</td>
<td>6837.0</td>
<td>433.0</td>
<td>3468.0</td>
<td>1405.0</td>
<td>3.1662</td>
<td>&lt;1H OCEAN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="scikit-learn-imputer-class" class="level5">
<h5 class="anchored" data-anchor-id="scikit-learn-imputer-class">Scikit-learn imputer class</h5>
<p>This is a handy class to take of missing values. First, we create an instance of that class with specifying what is to be replaced and what strategy is used. Before doing so, we need to make srue the entire data-set has ONLY numerical entries and Imputer will evaluate the given average for all the dataset and store it in the <code>statistics_</code> instance</p>
<p>What the imputer will do is, 1. Evaluate an specified type of average. 2. For a given numerical data-set look for NaN or Null entires in a given attribute and replace it with the computed avearge for that attribute</p>
<div id="cell-67" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer <span class="co"># Scikit-Learn 0.20+</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ImportError</span>:</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> sklearn.preprocessing <span class="im">import</span> Imputer <span class="im">as</span> SimpleImputer</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>imputer <span class="op">=</span> SimpleImputer(strategy<span class="op">=</span><span class="st">"median"</span>) <span class="co">#We define the strategy here </span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>housing_num <span class="op">=</span> housing.drop(<span class="st">'ocean_proximity'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="co"># alternatively: housing_num = housing.select_dtypes(include=[np.number])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-68" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>imputer.fit(housing_num)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>SimpleImputer(strategy='median')</code></pre>
</div>
</div>
<div id="cell-69" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>imputer.statistics_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>array([-118.51  ,   34.26  ,   29.    , 2119.5   ,  433.    , 1164.    ,
        408.    ,    3.5409])</code></pre>
</div>
</div>
<div id="cell-70" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>housing_num.median().values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>array([-118.51  ,   34.26  ,   29.    , 2119.5   ,  433.    , 1164.    ,
        408.    ,    3.5409])</code></pre>
</div>
</div>
<p>We can now use this as a training variables set for our model</p>
<div id="cell-72" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> imputer.transform(housing_num)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We convert the Pandas dataframe entries to a numpy array which is transformed with appropriately replacing the missing entries with median.</p>
<div id="cell-74" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(X), <span class="bu">type</span>(housing_num))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'numpy.ndarray'&gt; &lt;class 'pandas.core.frame.DataFrame'&gt;</code></pre>
</div>
</div>
<div id="cell-75" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.shape(X), housing_num.shape)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co">'''</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co">If we need the data-frame back</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co">housing_tr = pd.DataFrame(X, columns=housing_num.columns,</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co">                          index=housing.index)</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co">'''</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(16512, 8) (16512, 8)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>'\nIf we need the data-frame back\nhousing_tr = pd.DataFrame(X, columns=housing_num.columns,\n                          index=housing.index)\n'</code></pre>
</div>
</div>
</section>
</section>
<section id="handling-text-and-categorical-attribute" class="level3">
<h3 class="anchored" data-anchor-id="handling-text-and-categorical-attribute">Handling Text and Categorical Attribute</h3>
<p>Now let’s preprocess the categorical input feature, <code>ocean_proximity</code>:</p>
<div id="cell-77" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>housing_cat <span class="op">=</span> housing[[<span class="st">'ocean_proximity'</span>]]</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(housing_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>pandas.core.frame.DataFrame</code></pre>
</div>
</div>
<p>Converting the categorical entries to integers</p>
<div id="cell-79" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OrdinalEncoder</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ImportError</span>:</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> future_encoders <span class="im">import</span> OrdinalEncoder <span class="co"># Scikit-Learn &lt; 0.20</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>ordinal_encoder <span class="op">=</span> OrdinalEncoder()</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>housing_cat_encoded <span class="op">=</span> ordinal_encoder.fit_transform(housing_cat)</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>housing_cat_encoded[:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>array([[0.],
       [0.],
       [4.],
       [1.],
       [0.],
       [1.],
       [0.],
       [1.],
       [0.],
       [0.]])</code></pre>
</div>
</div>
<div id="cell-80" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>housing[<span class="st">"ocean_proximity"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>&lt;1H OCEAN     7276
INLAND        5263
NEAR OCEAN    2124
NEAR BAY      1847
ISLAND           2
Name: ocean_proximity, dtype: int64</code></pre>
</div>
</div>
<p>Now, <code>housing_cat_encoded</code> has converted the categorical entries to purely numerical values for each category</p>
<div id="cell-82" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>ordinal_encoder.categories_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>[array(['&lt;1H OCEAN', 'INLAND', 'ISLAND', 'NEAR BAY', 'NEAR OCEAN'],
       dtype=object)]</code></pre>
</div>
</div>
<p>Now, this is helpful with the string categories getting converted to numerical categories. However, there is still an small issue. The categorical numbering may introduce some bias in the final model. <strong>ML algorithms will assume that two nearby values are more similar than two distant values.</strong></p>
<p>In the above case, ‘&lt;1H OCEAN’ and ‘INLAND’have category values as 0 and 1 however’&lt;1H OCEAN’ is more closer to ‘NEAR OCEAN’ with category value 4.</p>
<p>To fix this issue, one solution is to create one binary attribute per category. This is called <strong>One-hot encoding</strong> as ONLY one of the attribute in the vector is 1 (hot) and others are 0 (cold).</p>
<p>Scikit-learn provides a <code>OneHotEncoder</code> encoder to convert integer categorical values to one-hot vectors.</p>
<div id="cell-84" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OrdinalEncoder <span class="co"># just to raise an ImportError if Scikit-Learn &lt; 0.20</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ImportError</span>:</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> future_encoders <span class="im">import</span> OneHotEncoder <span class="co"># Scikit-Learn &lt; 0.20</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>cat_encoder <span class="op">=</span> OneHotEncoder()</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="co">#1-Hot encoded vector for the housing training data-set </span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>housing_cat_1hot <span class="op">=</span> cat_encoder.fit_transform(housing_cat)</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(housing_cat_1hot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>scipy.sparse.csr.csr_matrix</code></pre>
</div>
</div>
<p>A sparse array is declared in this case which has the position of the non-zero value and not necessarily the entire numpy matrix. This is helpful in the cases where there are too many categories and also many datapoints. For examples, if we have 4 categories and 1000 datapoints the final one-hot matrix would be 1000x4 size. Most of that would be full of 0s, with only one 1 per row for a particular category.</p>
<p>The <code>housing_cat_1hot</code> can be converted to numpy array by using the <code>housing_cat_1hot.toarray()</code></p>
<p>Alternatively, you can set <code>sparse=False</code> when creating the <code>OneHotEncoder</code></p>
<div id="cell-86" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>cat_encoder.categories_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>[array(['&lt;1H OCEAN', 'INLAND', 'ISLAND', 'NEAR BAY', 'NEAR OCEAN'],
       dtype=object)]</code></pre>
</div>
</div>
<p>Let’s create a custom transformer to add extra attributes:</p>
<div id="cell-88" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>housing.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>Index(['longitude', 'latitude', 'housing_median_age', 'total_rooms',
       'total_bedrooms', 'population', 'households', 'median_income',
       'ocean_proximity'],
      dtype='object')</code></pre>
</div>
</div>
<div id="cell-89" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.base <span class="im">import</span> BaseEstimator, TransformerMixin</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="co"># get the right column indices: safer than hard-coding indices</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>rooms_ix, bedrooms_ix, population_ix, household_ix <span class="op">=</span> [</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">list</span>(housing.columns).index(col) <span class="cf">for</span> col <span class="kw">in</span> (<span class="st">"total_rooms"</span>, <span class="st">"total_bedrooms"</span>, <span class="st">"population"</span>, <span class="st">"households"</span>)]</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Here we convert the housing.columns to list and </span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="co">#then find the index for the entry which matches the string in the loop </span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CombinedAttributesAdder(BaseEstimator, TransformerMixin):</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, add_bedrooms_per_room <span class="op">=</span> <span class="va">True</span>): <span class="co"># no *args or **kwargs</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.add_bedrooms_per_room <span class="op">=</span> add_bedrooms_per_room</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, X, y<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>  <span class="co"># nothing else to do</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> transform(<span class="va">self</span>, X, y<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>        rooms_per_household <span class="op">=</span> X[:, rooms_ix] <span class="op">/</span> X[:, household_ix]</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>        population_per_household <span class="op">=</span> X[:, population_ix] <span class="op">/</span> X[:, household_ix]</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.add_bedrooms_per_room:</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>            bedrooms_per_room <span class="op">=</span> X[:, bedrooms_ix] <span class="op">/</span> X[:, rooms_ix]</span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> np.c_[X, rooms_per_household, population_per_household,</span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>                         bedrooms_per_room]</span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> np.c_[X, rooms_per_household, population_per_household]</span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a>attr_adder <span class="op">=</span> CombinedAttributesAdder(add_bedrooms_per_room<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>housing_extra_attribs <span class="op">=</span> attr_adder.transform(housing.values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From the above class, there’s only one hyperparameter in the class. <code>add_bedrooms_per_room</code> is the only option and is set True by default. Let’s check the new feature space by converting it to a <code>Pandas Dataframe</code></p>
<div id="cell-91" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>housing_extra_attribs <span class="op">=</span> pd.DataFrame(</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>    housing_extra_attribs,</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span><span class="bu">list</span>(housing.columns)<span class="op">+</span>[<span class="st">"bedrooms_per_room"</span>,<span class="st">"rooms_per_household"</span>, <span class="st">"population_per_household"</span>],</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>housing.index)</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>housing_extra_attribs.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">housing_median_age</th>
<th data-quarto-table-cell-role="th">total_rooms</th>
<th data-quarto-table-cell-role="th">total_bedrooms</th>
<th data-quarto-table-cell-role="th">population</th>
<th data-quarto-table-cell-role="th">households</th>
<th data-quarto-table-cell-role="th">median_income</th>
<th data-quarto-table-cell-role="th">ocean_proximity</th>
<th data-quarto-table-cell-role="th">bedrooms_per_room</th>
<th data-quarto-table-cell-role="th">rooms_per_household</th>
<th data-quarto-table-cell-role="th">population_per_household</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">17606</td>
<td>-121.89</td>
<td>37.29</td>
<td>38.0</td>
<td>1568.0</td>
<td>351.0</td>
<td>710.0</td>
<td>339.0</td>
<td>2.7042</td>
<td>&lt;1H OCEAN</td>
<td>4.625369</td>
<td>2.094395</td>
<td>0.223852</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">18632</td>
<td>-121.93</td>
<td>37.05</td>
<td>14.0</td>
<td>679.0</td>
<td>108.0</td>
<td>306.0</td>
<td>113.0</td>
<td>6.4214</td>
<td>&lt;1H OCEAN</td>
<td>6.00885</td>
<td>2.707965</td>
<td>0.159057</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14650</td>
<td>-117.2</td>
<td>32.77</td>
<td>31.0</td>
<td>1952.0</td>
<td>471.0</td>
<td>936.0</td>
<td>462.0</td>
<td>2.8621</td>
<td>NEAR OCEAN</td>
<td>4.225108</td>
<td>2.025974</td>
<td>0.241291</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3230</td>
<td>-119.61</td>
<td>36.31</td>
<td>25.0</td>
<td>1847.0</td>
<td>371.0</td>
<td>1460.0</td>
<td>353.0</td>
<td>1.8839</td>
<td>INLAND</td>
<td>5.232295</td>
<td>4.135977</td>
<td>0.200866</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3555</td>
<td>-118.59</td>
<td>34.23</td>
<td>17.0</td>
<td>6592.0</td>
<td>1525.0</td>
<td>4459.0</td>
<td>1463.0</td>
<td>3.0347</td>
<td>&lt;1H OCEAN</td>
<td>4.50581</td>
<td>3.047847</td>
<td>0.231341</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="feature-scaling" class="level3">
<h3 class="anchored" data-anchor-id="feature-scaling">Feature scaling</h3>
<p>Feaature scaling is an important transformation needed to be applied to the data. With some exceptions, ML algorithms dont perform well when the input numerical entries have very different scales. Eg: One variable has range 0-1 but other variable has range 1-1000. This is the case in our data-base where the total number of rooms range from 6 to 39,320 while the objective variable i.e.&nbsp;median income only ranges from 0-15. Two common ways of scaling:</p>
<ol type="1">
<li><p>Min-max scaling (also called Normalization) Values are shifted such that they are normalized. They are rescaled in the range of 0-1. We do this by subtracting the min value and dividing by the range in the data <span class="math display">\[\begin{equation}
x_{i} = \frac{X_{i}-min}{max-min}
\end{equation}\]</span></p></li>
<li><p>Standardization This is when the mean of the dataset is subtracted from each entry so that the data has mean as 0 and then divided by the standard deviation so that the resulting distribution has a unit variance. Unlike min-max scaling, standardization does not bound to a particular range like 0-1. However, <strong>standardisation is much less affected by outliers.</strong> If a particular values is extremely high or low that could affect the other inputs in the case of min-max scaling. However that effect is reduced in the case of standardization given it does not directly account for the range in the scaling but the mean and variance. <span class="math display">\[\begin{equation}
x_{i} = \frac{X_{i}-\mu}{\sigma}
\end{equation}\]</span></p></li>
</ol>
<blockquote class="blockquote">
<p><strong>NOTE:</strong> It is important that these scaling operations are performed on the training data only and not on the full dataset</p>
</blockquote>
</section>
<section id="transformation-pipelines" class="level3">
<h3 class="anchored" data-anchor-id="transformation-pipelines">Transformation pipelines</h3>
<p><code>Pipeline</code> class in scikit-learn can help with sequences of transformations. Now let’s build a pipeline for preprocessing the numerical attributes (note that we could use <code>CombinedAttributesAdder()</code> instead of <code>FunctionTransformer(...)</code> if we preferred):</p>
<div id="cell-94" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>num_pipeline <span class="op">=</span> Pipeline([</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'imputer'</span>, SimpleImputer(strategy<span class="op">=</span><span class="st">"median"</span>)), <span class="co">#Fill in missing values using the median of each entry </span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'attribs_adder'</span>, CombinedAttributesAdder(add_bedrooms_per_room<span class="op">=</span><span class="va">True</span>)), <span class="co">#Add additional columns entrys</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'std_scaler'</span>, StandardScaler()), <span class="co">#Feature scaling -- using standardisation here </span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>housing_num_tr <span class="op">=</span> num_pipeline.fit_transform(housing_num)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-95" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>housing_num_tr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>array([[-1.15604281,  0.77194962,  0.74333089, ..., -0.31205452,
        -0.08649871,  0.15531753],
       [-1.17602483,  0.6596948 , -1.1653172 , ...,  0.21768338,
        -0.03353391, -0.83628902],
       [ 1.18684903, -1.34218285,  0.18664186, ..., -0.46531516,
        -0.09240499,  0.4222004 ],
       ...,
       [ 1.58648943, -0.72478134, -1.56295222, ...,  0.3469342 ,
        -0.03055414, -0.52177644],
       [ 0.78221312, -0.85106801,  0.18664186, ...,  0.02499488,
         0.06150916, -0.30340741],
       [-1.43579109,  0.99645926,  1.85670895, ..., -0.22852947,
        -0.09586294,  0.10180567]])</code></pre>
</div>
</div>
<p>This <code>Pipeline</code> constructor takes a list of name/estimator pairs defining a sequence of steps. <strong>All but the last step/estimator must be the trasnformers (like feature scaling).</strong></p>
<div id="cell-97" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ImportError</span>:</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> future_encoders <span class="im">import</span> ColumnTransformer <span class="co"># Scikit-Learn &lt; 0.20</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Now let’s join all these components into a big pipeline that will preprocess both the numerical and the categorical features (again, we could use <code>CombinedAttributesAdder()</code> instead of <code>FunctionTransformer(...)</code> if we preferred):</strong></p>
<div id="cell-99" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>num_attribs <span class="op">=</span> <span class="bu">list</span>(housing_num)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>cat_attribs <span class="op">=</span> [<span class="st">"ocean_proximity"</span>]</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>full_pipeline <span class="op">=</span> ColumnTransformer([</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"num"</span>, num_pipeline, num_attribs),</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"cat"</span>, OneHotEncoder(), cat_attribs),</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>housing_prepared <span class="op">=</span> full_pipeline.fit_transform(housing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-100" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>housing_prepared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">
<pre><code>array([[-1.15604281,  0.77194962,  0.74333089, ...,  0.        ,
         0.        ,  0.        ],
       [-1.17602483,  0.6596948 , -1.1653172 , ...,  0.        ,
         0.        ,  0.        ],
       [ 1.18684903, -1.34218285,  0.18664186, ...,  0.        ,
         0.        ,  1.        ],
       ...,
       [ 1.58648943, -0.72478134, -1.56295222, ...,  0.        ,
         0.        ,  0.        ],
       [ 0.78221312, -0.85106801,  0.18664186, ...,  0.        ,
         0.        ,  0.        ],
       [-1.43579109,  0.99645926,  1.85670895, ...,  0.        ,
         1.        ,  0.        ]])</code></pre>
</div>
</div>
<div id="cell-101" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>housing_prepared.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="66">
<pre><code>(16512, 16)</code></pre>
</div>
</div>
</section>
<section id="step-3-select-and-train-a-model" class="level1">
<h1>Step 3: Select and train a model</h1>
<p>Finally.</p>
<section id="training-and-evaluation-on-the-training-set" class="level3">
<h3 class="anchored" data-anchor-id="training-and-evaluation-on-the-training-set">Training and evaluation on the training set</h3>
<p>Given the prioir transformations, the features are scaled, categories are converted to one-hot vectors, and the missing variables are taken account of. Let’s train a Linear Regression model first</p>
<div id="cell-104" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>lin_reg <span class="op">=</span> LinearRegression() </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>lin_reg.fit(housing_prepared, housing_labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>LinearRegression()</code></pre>
</div>
</div>
<div id="cell-105" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Test some data out on the model </span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>trial_input <span class="op">=</span> housing.iloc[:<span class="dv">5</span>] <span class="co">#First 5 entries </span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>trial_label <span class="op">=</span> housing_labels.iloc[:<span class="dv">5</span>] <span class="co">#First 5 labels corresponding to the entries </span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>prep_trial_input <span class="op">=</span> full_pipeline.transform(trial_input) <span class="co">#Transforming the entries to suit the trained input </span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Predictions:'</span>,lin_reg.predict(prep_trial_input))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Predictions: [210644.60459286 317768.80697211 210956.43331178  59218.98886849
 189747.55849879]</code></pre>
</div>
</div>
<div id="cell-106" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Labels:'</span>,<span class="bu">list</span>(trial_label))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Labels: [286600.0, 340600.0, 196900.0, 46300.0, 254500.0]</code></pre>
</div>
</div>
<div id="cell-107" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>housing_predictions <span class="op">=</span> lin_reg.predict(housing_prepared)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>lin_mse <span class="op">=</span> mean_squared_error(housing_labels, housing_predictions)</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>lin_rmse <span class="op">=</span> np.sqrt(lin_mse)</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>lin_rmse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="70">
<pre><code>68628.19819848923</code></pre>
</div>
</div>
<div id="cell-108" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>housing_labels.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<pre><code>count     16512.000000
mean     206990.920724
std      115703.014830
min       14999.000000
25%      119800.000000
50%      179500.000000
75%      263900.000000
max      500001.000000
Name: median_house_value, dtype: float64</code></pre>
</div>
</div>
<p>As seen the RMSE is 68628 which is better than nothing but still it is quite high when the range of the <code>median_house_values</code> range from 15000 to 500000</p>
<div id="cell-110" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_absolute_error</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>lin_mae <span class="op">=</span> mean_absolute_error(housing_labels, housing_predictions)</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>lin_mae</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<pre><code>49439.89599001897</code></pre>
</div>
</div>
<p>Here the model is underfitting the data since the RMSE is so high. &gt; When this happens either the features do not provide enough information to make good predictions or the model is not powerful enough.</p>
<p>Let’s try using a more complex model, <code>DecisionTreeRegressor</code> which is capable of finding non-linear relationships in the data</p>
</section>
<section id="decision-tree-regressor" class="level3">
<h3 class="anchored" data-anchor-id="decision-tree-regressor">Decision Tree Regressor</h3>
<div id="cell-112" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeRegressor</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>tree_reg <span class="op">=</span> DecisionTreeRegressor(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>tree_reg.fit(housing_prepared, housing_labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="73">
<pre><code>DecisionTreeRegressor(random_state=42)</code></pre>
</div>
</div>
<div id="cell-113" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>housing_predictions <span class="op">=</span> tree_reg.predict(housing_prepared)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>tree_mse <span class="op">=</span> mean_squared_error(housing_labels, housing_predictions)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>tree_rmse <span class="op">=</span> np.sqrt(tree_mse)</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>tree_rmse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">
<pre><code>0.0</code></pre>
</div>
</div>
<p>LOL!</p>
<p>This model is badly overfitting the data! Let’s proof this hypothesis using cross-validation schemes. We dont want to touch the test set, JUST WORK WITH THE TRAINING SET. Only touch the test set when the model we are using is good enough. We will use the part of the training set for training and other part for model validation.</p>
</section>
<section id="fine-tune-the-model" class="level3">
<h3 class="anchored" data-anchor-id="fine-tune-the-model">Fine-tune the model</h3>
<p><strong>Cross-validation</strong></p>
<p>Cross-validation is a method of getting reliable estimate of model performance using only the training data 10-fold cross-validation — breaking training data in 10 equal parts creating 10 miniature test/train splits. Out of the 10 folds, train data on 9 and test on 10th. Do this 10 times each time holding out different fold.</p>
<blockquote class="blockquote">
<p>Scikit-learn cross-validation feature expects a utility function (greater the better) rather than a cost function (lower the better), so to score the functions we use opposite of MSE, which is why we again compute <code>-scores</code> before calculating the square root</p>
</blockquote>
<div id="cell-116" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> cross_val_score(tree_reg, housing_prepared, housing_labels,</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>                         scoring<span class="op">=</span><span class="st">"neg_mean_squared_error"</span>, cv<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>tree_rmse_scores <span class="op">=</span> np.sqrt(<span class="op">-</span>scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-117" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> display_scores(scores):</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Scores:"</span>, scores)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Mean:"</span>, scores.mean())</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Standard deviation:"</span>, scores.std())</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>display_scores(tree_rmse_scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Scores: [70194.33680785 66855.16363941 72432.58244769 70758.73896782
 71115.88230639 75585.14172901 70262.86139133 70273.6325285
 75366.87952553 71231.65726027]
Mean: 71407.68766037929
Standard deviation: 2439.4345041191004</code></pre>
</div>
</div>
<p>Cross-validation not only allows us to get an estimate of the performance of the model but also the measure of how precise this estimate is (i.e.&nbsp;standard deviation). The Decision tree has high std-dev. This information could not be obtained with just one validation set. However, caveat is that cross-validation comes at the cost of training the model several times, so it is not always possible.</p>
<p>Let’s compute the same score for <code>LinearRegresson</code> model.</p>
<div id="cell-119" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>lin_scores <span class="op">=</span> cross_val_score(lin_reg, housing_prepared, housing_labels,</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>                             scoring<span class="op">=</span><span class="st">"neg_mean_squared_error"</span>, cv<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>lin_rmse_scores <span class="op">=</span> np.sqrt(<span class="op">-</span>lin_scores)</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>display_scores(lin_rmse_scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Scores: [66782.73843989 66960.118071   70347.95244419 74739.57052552
 68031.13388938 71193.84183426 64969.63056405 68281.61137997
 71552.91566558 67665.10082067]
Mean: 69052.46136345083
Standard deviation: 2731.674001798342</code></pre>
</div>
</div>
<p>Here it can be seen that DecisionTree model performs much worse than the LinearRegression model.</p>
</section>
<section id="random-forrest-regressor" class="level3">
<h3 class="anchored" data-anchor-id="random-forrest-regressor">Random Forrest Regressor</h3>
<p>Random forrest works by employing many decision trees on random subsets of the features, then averaging out their predictions. Building a model on top of many other models is called <code>Ensemble Learning</code> and it is often great way to push ML algorithms even further.</p>
<div id="cell-121" class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>forest_reg <span class="op">=</span> RandomForestRegressor(n_estimators<span class="op">=</span><span class="dv">10</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>forest_reg.fit(housing_prepared, housing_labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="78">
<pre><code>RandomForestRegressor(n_estimators=10, random_state=42)</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Note</strong>: we specify <code>n_estimators=10</code> to avoid a warning about the fact that the default value is going to change to 100 in Scikit-Learn 0.22.</p>
</blockquote>
<div id="cell-123" class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>housing_predictions <span class="op">=</span> forest_reg.predict(housing_prepared)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>forest_mse <span class="op">=</span> mean_squared_error(housing_labels, housing_predictions)</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>forest_rmse <span class="op">=</span> np.sqrt(forest_mse)</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>forest_rmse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="79">
<pre><code>21933.31414779769</code></pre>
</div>
</div>
<div id="cell-124" class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>forest_scores <span class="op">=</span> cross_val_score(forest_reg, housing_prepared, housing_labels,</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>                                scoring<span class="op">=</span><span class="st">"neg_mean_squared_error"</span>, cv<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>forest_rmse_scores <span class="op">=</span> np.sqrt(<span class="op">-</span>forest_scores)</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>display_scores(forest_rmse_scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Scores: [51646.44545909 48940.60114882 53050.86323649 54408.98730149
 50922.14870785 56482.50703987 51864.52025526 49760.85037653
 55434.21627933 53326.10093303]
Mean: 52583.72407377466
Standard deviation: 2298.353351147122</code></pre>
</div>
</div>
<p>Random forest regressor looks better than <code>DecisionTree</code> and <code>LinearRegression</code>. The RMSE is still quite high for production quality code and could be due to overfitting. We can try other algorithms before spending time on a particular algorithm tweaking the hyperparameters. The goal is to shortlist 2-3 methods that are promising then fine-tune the model. Before we move ahead we can take a look at one more ML algorithm which is commonly employed for such supervised learning cases: Support Vector Regression</p>
<div id="cell-126" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVR</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>svm_reg <span class="op">=</span> SVR(kernel<span class="op">=</span><span class="st">"linear"</span>)</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>svm_reg.fit(housing_prepared, housing_labels)</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>housing_predictions <span class="op">=</span> svm_reg.predict(housing_prepared)</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>svm_mse <span class="op">=</span> mean_squared_error(housing_labels, housing_predictions)</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>svm_rmse <span class="op">=</span> np.sqrt(svm_mse)</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>svm_rmse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="81">
<pre><code>111094.6308539982</code></pre>
</div>
</div>
</section>
</section>
<section id="step-4-fine-tune-the-model" class="level1">
<h1>Step 4: Fine-tune the model</h1>
<p>Once we settle for an algorithm we can fine-tune them efficiently using some of the in-built scikit-learn routines.</p>
<section id="grid-search" class="level3">
<h3 class="anchored" data-anchor-id="grid-search">Grid Search</h3>
<p><code>GridSearchCV</code> is a faster way of tweaking the hyper-parameters for a given algorithm. It needs the hyper-parameters you want to experiment with, what values to try out, and it will evaluate possible combination of hyperparameters values using cross-validation. We can do that step for <code>RandomForrestRegressor</code> which we found to have lowesst RMSE of the three methods we tried</p>
<div id="cell-128" class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> [</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># try 12 (3×4) combinations of hyperparameters</span></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'n_estimators'</span>: [<span class="dv">3</span>, <span class="dv">10</span>, <span class="dv">30</span>], <span class="st">'max_features'</span>: [<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>]},</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># then try 6 (2×3) combinations with bootstrap set as False</span></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'bootstrap'</span>: [<span class="va">False</span>], <span class="st">'n_estimators'</span>: [<span class="dv">3</span>, <span class="dv">10</span>], <span class="st">'max_features'</span>: [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>]},</span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>forest_reg <span class="op">=</span> RandomForestRegressor(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a><span class="co"># train across 5 folds, that's a total of (12+6)*5=90 rounds of training </span></span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a>grid_search <span class="op">=</span> GridSearchCV(forest_reg, param_grid, cv<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb122-14"><a href="#cb122-14" aria-hidden="true" tabindex="-1"></a>                           scoring<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>, return_train_score<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb122-15"><a href="#cb122-15" aria-hidden="true" tabindex="-1"></a>grid_search.fit(housing_prepared, housing_labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="82">
<pre><code>GridSearchCV(cv=5, estimator=RandomForestRegressor(random_state=42),
             param_grid=[{'max_features': [2, 4, 6, 8],
                          'n_estimators': [3, 10, 30]},
                         {'bootstrap': [False], 'max_features': [2, 3, 4],
                          'n_estimators': [3, 10]}],
             return_train_score=True, scoring='neg_mean_squared_error')</code></pre>
</div>
</div>
<p>The <code>param_grid</code> tells Scikit-learn to: 1. First evaluate 3x4 combinations of n_estimators and max_features with bootstrap <code>True</code> which is the default. 2. Then with bootstrap set as <code>False</code> we look for 2x3 combinations of n_estimators and max_featurs for the random forest 3. Finally, both these models are trained 5 times for the cross validation purposes in a 5-fold cross-validation fashion.</p>
<p>Total of (12+6)x5=90 round of training are conducted. Finally when it is done we get the best model parameters which give lowest RMSE.</p>
<div id="cell-130" class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>grid_search.best_params_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="83">
<pre><code>{'max_features': 8, 'n_estimators': 30}</code></pre>
</div>
</div>
<div id="cell-131" class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>grid_search.best_estimator_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="84">
<pre><code>RandomForestRegressor(max_features=8, n_estimators=30, random_state=42)</code></pre>
</div>
</div>
<div id="cell-132" class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>cvres <span class="op">=</span> grid_search.cv_results_</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mean_score, params <span class="kw">in</span> <span class="bu">zip</span>(cvres[<span class="st">"mean_test_score"</span>], cvres[<span class="st">"params"</span>]):</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(np.sqrt(<span class="op">-</span>mean_score), params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>63669.11631261028 {'max_features': 2, 'n_estimators': 3}
55627.099719926795 {'max_features': 2, 'n_estimators': 10}
53384.57275149205 {'max_features': 2, 'n_estimators': 30}
60965.950449450494 {'max_features': 4, 'n_estimators': 3}
52741.04704299915 {'max_features': 4, 'n_estimators': 10}
50377.40461678399 {'max_features': 4, 'n_estimators': 30}
58663.93866579625 {'max_features': 6, 'n_estimators': 3}
52006.19873526564 {'max_features': 6, 'n_estimators': 10}
50146.51167415009 {'max_features': 6, 'n_estimators': 30}
57869.25276169646 {'max_features': 8, 'n_estimators': 3}
51711.127883959234 {'max_features': 8, 'n_estimators': 10}
49682.273345071546 {'max_features': 8, 'n_estimators': 30}
62895.06951262424 {'bootstrap': False, 'max_features': 2, 'n_estimators': 3}
54658.176157539405 {'bootstrap': False, 'max_features': 2, 'n_estimators': 10}
59470.40652318466 {'bootstrap': False, 'max_features': 3, 'n_estimators': 3}
52724.9822587892 {'bootstrap': False, 'max_features': 3, 'n_estimators': 10}
57490.5691951261 {'bootstrap': False, 'max_features': 4, 'n_estimators': 3}
51009.495668875716 {'bootstrap': False, 'max_features': 4, 'n_estimators': 10}</code></pre>
</div>
</div>
<div id="cell-133" class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(grid_search.cv_results_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="86">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean_fit_time</th>
<th data-quarto-table-cell-role="th">std_fit_time</th>
<th data-quarto-table-cell-role="th">mean_score_time</th>
<th data-quarto-table-cell-role="th">std_score_time</th>
<th data-quarto-table-cell-role="th">param_max_features</th>
<th data-quarto-table-cell-role="th">param_n_estimators</th>
<th data-quarto-table-cell-role="th">param_bootstrap</th>
<th data-quarto-table-cell-role="th">params</th>
<th data-quarto-table-cell-role="th">split0_test_score</th>
<th data-quarto-table-cell-role="th">split1_test_score</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">mean_test_score</th>
<th data-quarto-table-cell-role="th">std_test_score</th>
<th data-quarto-table-cell-role="th">rank_test_score</th>
<th data-quarto-table-cell-role="th">split0_train_score</th>
<th data-quarto-table-cell-role="th">split1_train_score</th>
<th data-quarto-table-cell-role="th">split2_train_score</th>
<th data-quarto-table-cell-role="th">split3_train_score</th>
<th data-quarto-table-cell-role="th">split4_train_score</th>
<th data-quarto-table-cell-role="th">mean_train_score</th>
<th data-quarto-table-cell-role="th">std_train_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.053401</td>
<td>0.002499</td>
<td>0.003312</td>
<td>0.000173</td>
<td>2</td>
<td>3</td>
<td>NaN</td>
<td>{'max_features': 2, 'n_estimators': 3}</td>
<td>-3.837622e+09</td>
<td>-4.147108e+09</td>
<td>...</td>
<td>-4.053756e+09</td>
<td>1.519591e+08</td>
<td>18</td>
<td>-1.064113e+09</td>
<td>-1.105142e+09</td>
<td>-1.116550e+09</td>
<td>-1.112342e+09</td>
<td>-1.129650e+09</td>
<td>-1.105559e+09</td>
<td>2.220402e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.182488</td>
<td>0.002683</td>
<td>0.010123</td>
<td>0.001727</td>
<td>2</td>
<td>10</td>
<td>NaN</td>
<td>{'max_features': 2, 'n_estimators': 10}</td>
<td>-3.047771e+09</td>
<td>-3.254861e+09</td>
<td>...</td>
<td>-3.094374e+09</td>
<td>1.327062e+08</td>
<td>11</td>
<td>-5.927175e+08</td>
<td>-5.870952e+08</td>
<td>-5.776964e+08</td>
<td>-5.716332e+08</td>
<td>-5.802501e+08</td>
<td>-5.818785e+08</td>
<td>7.345821e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.503301</td>
<td>0.010947</td>
<td>0.024532</td>
<td>0.000476</td>
<td>2</td>
<td>30</td>
<td>NaN</td>
<td>{'max_features': 2, 'n_estimators': 30}</td>
<td>-2.689185e+09</td>
<td>-3.021086e+09</td>
<td>...</td>
<td>-2.849913e+09</td>
<td>1.626875e+08</td>
<td>9</td>
<td>-4.381089e+08</td>
<td>-4.391272e+08</td>
<td>-4.371702e+08</td>
<td>-4.376955e+08</td>
<td>-4.452654e+08</td>
<td>-4.394734e+08</td>
<td>2.966320e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.081569</td>
<td>0.001284</td>
<td>0.003247</td>
<td>0.000154</td>
<td>4</td>
<td>3</td>
<td>NaN</td>
<td>{'max_features': 4, 'n_estimators': 3}</td>
<td>-3.730181e+09</td>
<td>-3.786886e+09</td>
<td>...</td>
<td>-3.716847e+09</td>
<td>1.631510e+08</td>
<td>16</td>
<td>-9.865163e+08</td>
<td>-1.012565e+09</td>
<td>-9.169425e+08</td>
<td>-1.037400e+09</td>
<td>-9.707739e+08</td>
<td>-9.848396e+08</td>
<td>4.084607e+07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.269809</td>
<td>0.005145</td>
<td>0.008730</td>
<td>0.000133</td>
<td>4</td>
<td>10</td>
<td>NaN</td>
<td>{'max_features': 4, 'n_estimators': 10}</td>
<td>-2.666283e+09</td>
<td>-2.784511e+09</td>
<td>...</td>
<td>-2.781618e+09</td>
<td>1.268607e+08</td>
<td>8</td>
<td>-5.097115e+08</td>
<td>-5.162820e+08</td>
<td>-4.962893e+08</td>
<td>-5.436192e+08</td>
<td>-5.160297e+08</td>
<td>-5.163863e+08</td>
<td>1.542862e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>0.800619</td>
<td>0.007793</td>
<td>0.024065</td>
<td>0.000543</td>
<td>4</td>
<td>30</td>
<td>NaN</td>
<td>{'max_features': 4, 'n_estimators': 30}</td>
<td>-2.387153e+09</td>
<td>-2.588448e+09</td>
<td>...</td>
<td>-2.537883e+09</td>
<td>1.214614e+08</td>
<td>3</td>
<td>-3.838835e+08</td>
<td>-3.880268e+08</td>
<td>-3.790867e+08</td>
<td>-4.040957e+08</td>
<td>-3.845520e+08</td>
<td>-3.879289e+08</td>
<td>8.571233e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>0.113473</td>
<td>0.004140</td>
<td>0.003330</td>
<td>0.000178</td>
<td>6</td>
<td>3</td>
<td>NaN</td>
<td>{'max_features': 6, 'n_estimators': 3}</td>
<td>-3.119657e+09</td>
<td>-3.586319e+09</td>
<td>...</td>
<td>-3.441458e+09</td>
<td>1.893056e+08</td>
<td>14</td>
<td>-9.245343e+08</td>
<td>-8.886939e+08</td>
<td>-9.353135e+08</td>
<td>-9.009801e+08</td>
<td>-8.624664e+08</td>
<td>-9.023976e+08</td>
<td>2.591445e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>0.378872</td>
<td>0.014358</td>
<td>0.009405</td>
<td>0.001258</td>
<td>6</td>
<td>10</td>
<td>NaN</td>
<td>{'max_features': 6, 'n_estimators': 10}</td>
<td>-2.549663e+09</td>
<td>-2.782039e+09</td>
<td>...</td>
<td>-2.704645e+09</td>
<td>1.471569e+08</td>
<td>6</td>
<td>-4.980344e+08</td>
<td>-5.045869e+08</td>
<td>-4.994664e+08</td>
<td>-4.990325e+08</td>
<td>-5.055542e+08</td>
<td>-5.013349e+08</td>
<td>3.100456e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>1.222785</td>
<td>0.030201</td>
<td>0.027815</td>
<td>0.001110</td>
<td>6</td>
<td>30</td>
<td>NaN</td>
<td>{'max_features': 6, 'n_estimators': 30}</td>
<td>-2.370010e+09</td>
<td>-2.583638e+09</td>
<td>...</td>
<td>-2.514673e+09</td>
<td>1.285080e+08</td>
<td>2</td>
<td>-3.838538e+08</td>
<td>-3.804711e+08</td>
<td>-3.805218e+08</td>
<td>-3.856095e+08</td>
<td>-3.901917e+08</td>
<td>-3.841296e+08</td>
<td>3.617057e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>0.146751</td>
<td>0.002996</td>
<td>0.003320</td>
<td>0.000174</td>
<td>8</td>
<td>3</td>
<td>NaN</td>
<td>{'max_features': 8, 'n_estimators': 3}</td>
<td>-3.353504e+09</td>
<td>-3.348552e+09</td>
<td>...</td>
<td>-3.348850e+09</td>
<td>1.241939e+08</td>
<td>13</td>
<td>-9.228123e+08</td>
<td>-8.553031e+08</td>
<td>-8.603321e+08</td>
<td>-8.881964e+08</td>
<td>-9.151287e+08</td>
<td>-8.883545e+08</td>
<td>2.750227e+07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>0.510138</td>
<td>0.016372</td>
<td>0.009396</td>
<td>0.000904</td>
<td>8</td>
<td>10</td>
<td>NaN</td>
<td>{'max_features': 8, 'n_estimators': 10}</td>
<td>-2.571970e+09</td>
<td>-2.718994e+09</td>
<td>...</td>
<td>-2.674041e+09</td>
<td>1.392777e+08</td>
<td>5</td>
<td>-4.932416e+08</td>
<td>-4.815238e+08</td>
<td>-4.730979e+08</td>
<td>-5.155367e+08</td>
<td>-4.985555e+08</td>
<td>-4.923911e+08</td>
<td>1.459294e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>1.518905</td>
<td>0.056501</td>
<td>0.025125</td>
<td>0.001086</td>
<td>8</td>
<td>30</td>
<td>NaN</td>
<td>{'max_features': 8, 'n_estimators': 30}</td>
<td>-2.357390e+09</td>
<td>-2.546640e+09</td>
<td>...</td>
<td>-2.468328e+09</td>
<td>1.091662e+08</td>
<td>1</td>
<td>-3.841658e+08</td>
<td>-3.744500e+08</td>
<td>-3.773239e+08</td>
<td>-3.882250e+08</td>
<td>-3.810005e+08</td>
<td>-3.810330e+08</td>
<td>4.871017e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>0.077979</td>
<td>0.001837</td>
<td>0.003983</td>
<td>0.000390</td>
<td>2</td>
<td>3</td>
<td>False</td>
<td>{'bootstrap': False, 'max_features': 2, 'n_est...</td>
<td>-3.785816e+09</td>
<td>-4.166012e+09</td>
<td>...</td>
<td>-3.955790e+09</td>
<td>1.900964e+08</td>
<td>17</td>
<td>-0.000000e+00</td>
<td>-0.000000e+00</td>
<td>-0.000000e+00</td>
<td>-0.000000e+00</td>
<td>-0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>0.259085</td>
<td>0.003267</td>
<td>0.010411</td>
<td>0.000311</td>
<td>2</td>
<td>10</td>
<td>False</td>
<td>{'bootstrap': False, 'max_features': 2, 'n_est...</td>
<td>-2.810721e+09</td>
<td>-3.107789e+09</td>
<td>...</td>
<td>-2.987516e+09</td>
<td>1.539234e+08</td>
<td>10</td>
<td>-6.056477e-02</td>
<td>-0.000000e+00</td>
<td>-0.000000e+00</td>
<td>-0.000000e+00</td>
<td>-2.967449e+00</td>
<td>-6.056027e-01</td>
<td>1.181156e+00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>0.104454</td>
<td>0.004167</td>
<td>0.003841</td>
<td>0.000315</td>
<td>3</td>
<td>3</td>
<td>False</td>
<td>{'bootstrap': False, 'max_features': 3, 'n_est...</td>
<td>-3.618324e+09</td>
<td>-3.441527e+09</td>
<td>...</td>
<td>-3.536729e+09</td>
<td>7.795057e+07</td>
<td>15</td>
<td>-0.000000e+00</td>
<td>-0.000000e+00</td>
<td>-0.000000e+00</td>
<td>-0.000000e+00</td>
<td>-6.072840e+01</td>
<td>-1.214568e+01</td>
<td>2.429136e+01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>0.345978</td>
<td>0.004147</td>
<td>0.010372</td>
<td>0.000444</td>
<td>3</td>
<td>10</td>
<td>False</td>
<td>{'bootstrap': False, 'max_features': 3, 'n_est...</td>
<td>-2.757999e+09</td>
<td>-2.851737e+09</td>
<td>...</td>
<td>-2.779924e+09</td>
<td>6.286720e+07</td>
<td>7</td>
<td>-2.089484e+01</td>
<td>-0.000000e+00</td>
<td>-0.000000e+00</td>
<td>-0.000000e+00</td>
<td>-5.465556e+00</td>
<td>-5.272080e+00</td>
<td>8.093117e+00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>0.135484</td>
<td>0.015839</td>
<td>0.004140</td>
<td>0.000585</td>
<td>4</td>
<td>3</td>
<td>False</td>
<td>{'bootstrap': False, 'max_features': 4, 'n_est...</td>
<td>-3.134040e+09</td>
<td>-3.559375e+09</td>
<td>...</td>
<td>-3.305166e+09</td>
<td>1.879165e+08</td>
<td>12</td>
<td>-0.000000e+00</td>
<td>-0.000000e+00</td>
<td>-0.000000e+00</td>
<td>-0.000000e+00</td>
<td>-0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>0.453605</td>
<td>0.013427</td>
<td>0.010725</td>
<td>0.000358</td>
<td>4</td>
<td>10</td>
<td>False</td>
<td>{'bootstrap': False, 'max_features': 4, 'n_est...</td>
<td>-2.525578e+09</td>
<td>-2.710011e+09</td>
<td>...</td>
<td>-2.601969e+09</td>
<td>1.088048e+08</td>
<td>4</td>
<td>-0.000000e+00</td>
<td>-1.514119e-02</td>
<td>-0.000000e+00</td>
<td>-0.000000e+00</td>
<td>-0.000000e+00</td>
<td>-3.028238e-03</td>
<td>6.056477e-03</td>
</tr>
</tbody>
</table>

<p>18 rows × 23 columns</p>
</div>
</div>
</div>
</section>
<section id="randomised-search" class="level3">
<h3 class="anchored" data-anchor-id="randomised-search">Randomised search</h3>
<p>Grid search approach is fine when we are exploring relatively few combinations. But when hyperparameter space is large it is often preferrable to use <code>RandomizedSearchCV</code> instead. Here instead of doing all the possible combinationes of hyperparameters, it evaluates a given number of random combinations by selecting a random value for each hyper parameter at every iteration.</p>
</section>
<section id="ensemble-search" class="level3">
<h3 class="anchored" data-anchor-id="ensemble-search">Ensemble search</h3>
<p>Combine models that perform best. The group or ‘ensemble’ will often perform better than the best individual model just like RandomForest peforms better than Decision Trees especially if we have individual models make different types of errors.</p>
</section>
</section>
<section id="step-5-analyze-the-best-models-and-their-errors" class="level1">
<h1>Step 5: Analyze the Best Models and their Errors</h1>
<p><code>RandomForestRegressor</code> can indicate the relative importance of each attribute for making the accurate predictions.</p>
<div id="cell-135" class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>feature_importances <span class="op">=</span> grid_search.best_estimator_.feature_importances_</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>feature_importances</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="87">
<pre><code>array([7.33442355e-02, 6.29090705e-02, 4.11437985e-02, 1.46726854e-02,
       1.41064835e-02, 1.48742809e-02, 1.42575993e-02, 3.66158981e-01,
       5.64191792e-02, 1.08792957e-01, 5.33510773e-02, 1.03114883e-02,
       1.64780994e-01, 6.02803867e-05, 1.96041560e-03, 2.85647464e-03])</code></pre>
</div>
</div>
<div id="cell-136" class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>extra_attribs <span class="op">=</span> [<span class="st">"rooms_per_hhold"</span>, <span class="st">"pop_per_hhold"</span>, <span class="st">"bedrooms_per_room"</span>]</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>cat_encoder <span class="op">=</span> full_pipeline.named_transformers_[<span class="st">"cat"</span>]</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>cat_one_hot_attribs <span class="op">=</span> <span class="bu">list</span>(cat_encoder.categories_[<span class="dv">0</span>])</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>attributes <span class="op">=</span> num_attribs <span class="op">+</span> extra_attribs <span class="op">+</span> cat_one_hot_attribs</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="bu">sorted</span>(<span class="bu">zip</span>(feature_importances, attributes), reverse<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="88">
<pre><code>[(0.36615898061813423, 'median_income'),
 (0.16478099356159054, 'INLAND'),
 (0.10879295677551575, 'pop_per_hhold'),
 (0.07334423551601243, 'longitude'),
 (0.06290907048262032, 'latitude'),
 (0.056419179181954014, 'rooms_per_hhold'),
 (0.053351077347675815, 'bedrooms_per_room'),
 (0.04114379847872964, 'housing_median_age'),
 (0.014874280890402769, 'population'),
 (0.014672685420543239, 'total_rooms'),
 (0.014257599323407808, 'households'),
 (0.014106483453584104, 'total_bedrooms'),
 (0.010311488326303788, '&lt;1H OCEAN'),
 (0.0028564746373201584, 'NEAR OCEAN'),
 (0.0019604155994780706, 'NEAR BAY'),
 (6.0280386727366e-05, 'ISLAND')]</code></pre>
</div>
</div>
</section>
<section id="step-6-evaluate-the-model-on-the-test-set" class="level1">
<h1>Step 6: Evaluate the model on the Test Set</h1>
<div id="cell-138" class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>final_model <span class="op">=</span> grid_search.best_estimator_</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> strat_test_set.drop(<span class="st">"median_house_value"</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> strat_test_set[<span class="st">"median_house_value"</span>].copy()</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>X_test_prepared <span class="op">=</span> full_pipeline.transform(X_test)</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>final_predictions <span class="op">=</span> final_model.predict(X_test_prepared)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-139" class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>ax.scatter(y_test, final_predictions, s<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>lims <span class="op">=</span> [np.<span class="bu">min</span>([ax.get_xlim(), ax.get_ylim()]),  <span class="co"># min of both axes</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>        np.<span class="bu">max</span>([ax.get_xlim(), ax.get_ylim()]),  <span class="co"># max of both axes</span></span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>       ]</span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>ax.plot(lims, lims, <span class="st">'k--'</span>, linewidth<span class="op">=</span><span class="fl">2.0</span>, alpha<span class="op">=</span><span class="fl">0.75</span>, zorder<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">'equal'</span>)</span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(lims)</span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>ax.set_ylim(lims)</span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'ML Prediction'</span>)</span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Actual Value'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="90">
<pre><code>Text(0, 0.5, 'Actual Value')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2019-08-02-end2endML_housing_files/figure-html/cell-87-output-2.png" width="540" height="495" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-140" class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>final_mse <span class="op">=</span> mean_squared_error(y_test, final_predictions)</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>final_rmse <span class="op">=</span> np.sqrt(final_mse)</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(final_rmse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>47730.22690385927</code></pre>
</div>
</div>
<p>We can compute a 95% confidence interval for the test RMSE:</p>
<div id="cell-142" class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>confidence <span class="op">=</span> <span class="fl">0.95</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>squared_errors <span class="op">=</span> (final_predictions <span class="op">-</span> y_test) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>mean <span class="op">=</span> squared_errors.mean()</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> <span class="bu">len</span>(squared_errors)</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>np.sqrt(stats.t.interval(confidence, m <span class="op">-</span> <span class="dv">1</span>,</span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>                         loc<span class="op">=</span>np.mean(squared_errors),</span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>                         scale<span class="op">=</span>stats.sem(squared_errors)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="92">
<pre><code>array([45685.10470776, 49691.25001878])</code></pre>
</div>
</div>
<p>Alternatively, we could use a z-scores rather than t-scores:</p>
<div id="cell-144" class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>zscore <span class="op">=</span> stats.norm.ppf((<span class="dv">1</span> <span class="op">+</span> confidence) <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>zmargin <span class="op">=</span> zscore <span class="op">*</span> squared_errors.std(ddof<span class="op">=</span><span class="dv">1</span>) <span class="op">/</span> np.sqrt(m)</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>np.sqrt(mean <span class="op">-</span> zmargin), np.sqrt(mean <span class="op">+</span> zmargin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="93">
<pre><code>(45685.717918136594, 49690.68623889426)</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>